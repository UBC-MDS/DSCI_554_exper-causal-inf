

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Lecture 5 - More Power and Early Stopping in A/B Testing &#8212; DSCI 554 - Experimentation and Causal Inference</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.5ea377869091fd0449014c60fc090103.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notes/lecture5_more_power_early_stopping';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lecture 6 - Observational Data: Stratifying and Modelling" href="lecture6_obs_stratifying_modelling.html" />
    <link rel="prev" title="Lecture 4 - More Blocking and Power" href="lecture4_more_blocking_and_power.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../README.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/UBC_MDS_logo.png" class="logo__image only-light" alt="DSCI 554 - Experimentation and Causal Inference - Home"/>
    <script>document.write(`<img src="../_static/UBC_MDS_logo.png" class="logo__image only-dark" alt="DSCI 554 - Experimentation and Causal Inference - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../README.html">
                    Welcome to DSCI 554: Experimentation and Causal Inference
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Lectures</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../lecture-learning-objectives.html">Lecture Learning Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture1_multiple_comparisons.html">Lecture 1 - Multiple Comparisons</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture2_simpson_confounding.html">Lecture 2 - Confounding and Randomized versus Non-randomized Studies</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture3_randomization_and_blocking.html">Lecture 3 - Randomization and Blocking</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture4_more_blocking_and_power.html">Lecture 4 - More Blocking and Power</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Lecture 5 - More Power and Early Stopping in A/B Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture6_obs_stratifying_modelling.html">Lecture 6 - Observational Data: Stratifying and Modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture7_obs_sampling_schemes.html">Lecture 7 - Observational Data: Different Sampling Schemes</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture8_match_constrasts_wrapup.html">Lecture 8 - Matched Case-Control Scheme, Ordinal Regressors, and Final Wrap-Up</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="appendix_blocking_and_stratification.html">Blocking and Stratification</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix-causality-exp-cheatsheet.html">Causality and Experimentation Cheatsheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix-prob-cheatsheet.html">Probability Cheatsheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix-reg-mindmap.html">Regression Mind Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix-reg-cheatsheet.html">Regression Cheatsheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix-dist-cheatsheet.html">Distribution Cheatsheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix-greek-alphabet.html">Greek Alphabet</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.ubc.ca/MDS-2023-24/DSCI_554_exper-causal-inf_students" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.ubc.ca/MDS-2023-24/DSCI_554_exper-causal-inf_students/issues/new?title=Issue%20on%20page%20%2Fnotes/lecture5_more_power_early_stopping.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notes/lecture5_more_power_early_stopping.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lecture 5 - More Power and Early Stopping in A/B Testing</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#today-s-learning-objectives">Today’s Learning Objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-r-packages">Loading <code class="docutils literal notranslate"><span class="pre">R</span></code> Packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sample-size-computations-in-plots">1. Sample Size Computations in Plots</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#revisiting-the-example">1.1. Revisiting the Example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-function-pwr-t-test">1.2. Using Function <code class="docutils literal notranslate"><span class="pre">pwr.t.test()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-results">1.3. Plotting Results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#alternative-plotting">1.4. Alternative Plotting</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sample-size-computations-with-click-through-rates">2. Sample Size Computations with Click-through Rates</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-interlude-on-the-arcsine-transformation-for-the-effect-size">2.1. An Interlude on the Arcsine Transformation for the Effect Size</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-function-pwr-2p-test">2.2. Using Function <code class="docutils literal notranslate"><span class="pre">pwr.2p.test()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#early-stopping-in-a-b-testing">3. Early Stopping in A/B Testing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-to-peeking">3.1. Introduction to Peeking</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#three-simulation-studies-with-aggressive-peeking">3.2. Three Simulation Studies with Aggressive Peeking</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#what-happens-when-text-ctr-b-text-ctr-a-in-a-simulation-study-if-we-apply-aggressive-peeking-everytime-there-is-a-new-visitor">3.2.1. What happens when <span class="math notranslate nohighlight">\(\text{CTR}_B &gt; \text{CTR}_A\)</span> in a simulation study if we apply aggressive peeking everytime there is a new visitor?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#what-happens-when-text-ctr-b-text-ctr-a-under-a-smaller-percentage-increase-in-a-simulation-study-if-we-apply-aggresive-peeking-every-time-there-is-a-new-visitor">3.2.2. What happens when <span class="math notranslate nohighlight">\(\text{CTR}_B &gt; \text{CTR}_A\)</span>  under a smaller percentage increase in a simulation study if we apply aggresive peeking every time there is a new visitor?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#what-happens-when-text-ctr-b-text-ctr-a-in-a-simulation-study-if-we-apply-aggresive-peeking-everytime-there-is-a-new-visitor">3.2.3. What happens when <span class="math notranslate nohighlight">\(\text{CTR}_B = \text{CTR}_A\)</span> in a simulation study if we apply aggresive peeking everytime there is a new visitor?</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#final-simulation-studies-with-principled-peeking">3.3. Final Simulation Studies with Principled Peeking</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#wrapping-up">4. Wrapping Up</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lecture-5-more-power-and-early-stopping-in-a-b-testing">
<h1>Lecture 5 - More Power and Early Stopping in A/B Testing<a class="headerlink" href="#lecture-5-more-power-and-early-stopping-in-a-b-testing" title="Permalink to this heading">#</a></h1>
<section id="today-s-learning-objectives">
<h2>Today’s Learning Objectives<a class="headerlink" href="#today-s-learning-objectives" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Comment on nuances of randomized experiments that arise specifically for website optimization problems.</p></li>
<li><p>Determine an adequate sample size (i.e., experiment duration) for such problems.</p></li>
<li><p>Apply clever plotting arrangements to communicate power analyses.</p></li>
<li><p>Relate the danger of “early stopping” to experiments in A/B testing.</p></li>
<li><p>Analyze the advantages and disadvantages of aggressive and principled peekings in A/B testing.</p></li>
</ol>
</section>
<section id="loading-r-packages">
<h2>Loading <code class="docutils literal notranslate"><span class="pre">R</span></code> Packages<a class="headerlink" href="#loading-r-packages" title="Permalink to this heading">#</a></h2>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">repr.matrix.max.rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">pwr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">broom</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">cowplot</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="sample-size-computations-in-plots">
<h2>1. Sample Size Computations in Plots<a class="headerlink" href="#sample-size-computations-in-plots" title="Permalink to this heading">#</a></h2>
<p>We already introduced the <code class="docutils literal notranslate"><span class="pre">R</span></code> function <code class="docutils literal notranslate"><span class="pre">pwr.t.test()</span></code> from library <code class="docutils literal notranslate"><span class="pre">pwr</span></code> to compute sample sizes in an A/B testing framework where the response is continuous. Moreover, we generated a table with different scenarios of <strong>power <span class="math notranslate nohighlight">\(1 - \beta\)</span></strong>, <strong>significance level <span class="math notranslate nohighlight">\(\alpha\)</span></strong>, and <strong>effect difference <span class="math notranslate nohighlight">\(\delta\)</span></strong> (i.e., the effect difference between the control and experimental treatments in terms of the outcome of interest).</p>
<p>We also introduced a handy Power Analysis plotting arrangement in <a class="reference internal" href="lecture4_more_blocking_and_power.html"><span class="doc">Lecture 4 - More Blocking and Power</span></a>.</p>
<p><strong>Let us explore other plotting alternatives!</strong></p>
<section id="revisiting-the-example">
<h3>1.1. Revisiting the Example<a class="headerlink" href="#revisiting-the-example" title="Permalink to this heading">#</a></h3>
<p>We want to do an A/B testing to see if a tweak (<strong>version B</strong>) of our existing site (<strong>version A</strong>) promotes site visitors to stay longer.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>The boss will not sign off on this without some certainty around how many visitors will be randomized to either version A or B.</p>
</div>
<p><strong>We know that CURRENTLY, around 95% of the visitors stay between 30 seconds and 2 minutes.</strong> Moreover, we would permanently switch to the tweaked site if we were convinced it improved visit length by 3% (or more!).</p>
<div class="admonition-main-statistical-inquiry admonition">
<p class="admonition-title">Main Statistical Inquiry</p>
<p>Given the problem’s setup, how large should we set up our sample size so we can detect this difference (if there is any)?</p>
</div>
</section>
<section id="using-function-pwr-t-test">
<h3>1.2. Using Function <code class="docutils literal notranslate"><span class="pre">pwr.t.test()</span></code><a class="headerlink" href="#using-function-pwr-t-test" title="Permalink to this heading">#</a></h3>
<p>We will not go into the specific details on the use of the function <code class="docutils literal notranslate"><span class="pre">pwr.t.test()</span></code> and the computations of <span class="math notranslate nohighlight">\(\mu_A = 1.25\)</span> and <span class="math notranslate nohighlight">\(\sigma = 0.383\)</span> min. Nonetheless, we need to set up the following values for computing different sample sizes:</p>
<ul class="simple">
<li><p>A single value for <span class="math notranslate nohighlight">\(\alpha = 0.05\)</span> (i.e., the default <strong>significance level</strong>).</p></li>
<li><p><span class="math notranslate nohighlight">\(1 - \beta\)</span> (<strong>power</strong>): <span class="math notranslate nohighlight">\(0.70\)</span>, <span class="math notranslate nohighlight">\(0.80\)</span>, and <span class="math notranslate nohighlight">\(0.90\)</span>. The larger the <strong>power</strong>, the less prone we will be to commit type II error.</p></li>
<li><p>Increases in the response of interest with <span class="math notranslate nohighlight">\(\delta = 0.0375, 0.0625, 0.0875, 0.1125, 0.1375, 0.1625\)</span> in treatment B with respect to treatment A (i.e., increases of 3, 5, 7, 9, 11, and 13%).</p></li>
</ul>
<p>As previously done in <a class="reference internal" href="lecture4_more_blocking_and_power.html"><span class="doc">Lecture 4 - More Blocking and Power</span></a>, we need to prepare a grid with all the possible combinations for <code class="docutils literal notranslate"><span class="pre">alpha</span></code>, <code class="docutils literal notranslate"><span class="pre">power</span></code>, and <code class="docutils literal notranslate"><span class="pre">delta</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let us obtain all possible setting combinations</span>
<span class="n">alpha</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.05</span>
<span class="n">power</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.7</span><span class="p">,</span><span class="w"> </span><span class="m">0.8</span><span class="p">,</span><span class="w"> </span><span class="m">0.9</span><span class="p">)</span>
<span class="n">delta</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.0375</span><span class="p">,</span><span class="w"> </span><span class="m">0.0625</span><span class="p">,</span><span class="w"> </span><span class="m">0.0875</span><span class="p">,</span><span class="w"> </span><span class="m">0.1125</span><span class="p">,</span><span class="w"> </span><span class="m">0.1375</span><span class="p">,</span><span class="w"> </span><span class="m">0.1625</span><span class="p">)</span>
<span class="n">experimental_grid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">expand.grid</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">power</span><span class="p">,</span><span class="w"> </span><span class="n">delta</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">experimental_grid</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;alpha&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;power&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;delta&quot;</span><span class="p">)</span>
<span class="c1"># Adding a column for the overall sample size n</span>
<span class="n">experimental_grid</span><span class="o">$</span><span class="n">overall_n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span>
<span class="n">experimental_grid</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 18 × 4</caption>
<thead>
	<tr><th scope=col>alpha</th><th scope=col>power</th><th scope=col>delta</th><th scope=col>overall_n</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;lgl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>0.05</td><td>0.7</td><td>0.0375</td><td>NA</td></tr>
	<tr><td>0.05</td><td>0.8</td><td>0.0375</td><td>NA</td></tr>
	<tr><td>0.05</td><td>0.9</td><td>0.0375</td><td>NA</td></tr>
	<tr><td>0.05</td><td>0.7</td><td>0.0625</td><td>NA</td></tr>
	<tr><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td></tr>
	<tr><td>0.05</td><td>0.9</td><td>0.1375</td><td>NA</td></tr>
	<tr><td>0.05</td><td>0.7</td><td>0.1625</td><td>NA</td></tr>
	<tr><td>0.05</td><td>0.8</td><td>0.1625</td><td>NA</td></tr>
	<tr><td>0.05</td><td>0.9</td><td>0.1625</td><td>NA</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Then, we use the function <code class="docutils literal notranslate"><span class="pre">pwr.t.test()</span></code> with all the possible combinations from <code class="docutils literal notranslate"><span class="pre">experimental_grid</span></code>. We also need to set up the value for <code class="docutils literal notranslate"><span class="pre">sigma</span></code>. Recall the elements of <code class="docutils literal notranslate"><span class="pre">pwr.t.test()</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">d</span></code>: Desired effect size (<span class="math notranslate nohighlight">\(\delta\)</span> divided by <span class="math notranslate nohighlight">\(\sigma\)</span>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sig.level</span></code>: Chosen <span class="math notranslate nohighlight">\(\alpha\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">power</span></code>: Chosen power <span class="math notranslate nohighlight">\(1 - \beta\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: Type of test (in the A/B testing context we have a <code class="docutils literal notranslate"><span class="pre">two.sample</span></code> test).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">alternative</span></code>: Our hypothesis test is one-sided, thus <code class="docutils literal notranslate"><span class="pre">greater</span></code>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">sigma</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.383</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">nrow</span><span class="p">(</span><span class="n">experimental_grid</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1"># Using pwr.t.test() function</span>
<span class="w">  </span><span class="n">sample_size</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">tidy</span><span class="p">(</span><span class="nf">pwr.t.test</span><span class="p">(</span>
<span class="w">    </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">experimental_grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;delta&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">sigma</span><span class="p">,</span>
<span class="w">    </span><span class="n">sig.level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">experimental_grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;alpha&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="n">power</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">experimental_grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;power&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;two.sample&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">alternative</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;greater&quot;</span>
<span class="w">  </span><span class="p">))</span>

<span class="w">  </span><span class="c1"># Recording overall sample size</span>
<span class="w">  </span><span class="n">experimental_grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;overall_n&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">ceiling</span><span class="p">(</span><span class="n">sample_size</span><span class="o">$</span><span class="n">n</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Once we have run our sample size computations, we have the table of results below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">repr.matrix.max.rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">18</span><span class="p">)</span>
<span class="n">experimental_grid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">experimental_grid</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">power</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">power</span><span class="p">))</span>
<span class="n">experimental_grid</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 18 × 4</caption>
<thead>
	<tr><th scope=col>alpha</th><th scope=col>power</th><th scope=col>delta</th><th scope=col>overall_n</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>0.05</td><td>0.7</td><td>0.0375</td><td>1966</td></tr>
	<tr><td>0.05</td><td>0.8</td><td>0.0375</td><td>2582</td></tr>
	<tr><td>0.05</td><td>0.9</td><td>0.0375</td><td>3576</td></tr>
	<tr><td>0.05</td><td>0.7</td><td>0.0625</td><td> 710</td></tr>
	<tr><td>0.05</td><td>0.8</td><td>0.0625</td><td> 932</td></tr>
	<tr><td>0.05</td><td>0.9</td><td>0.0625</td><td>1288</td></tr>
	<tr><td>0.05</td><td>0.7</td><td>0.0875</td><td> 362</td></tr>
	<tr><td>0.05</td><td>0.8</td><td>0.0875</td><td> 476</td></tr>
	<tr><td>0.05</td><td>0.9</td><td>0.0875</td><td> 658</td></tr>
	<tr><td>0.05</td><td>0.7</td><td>0.1125</td><td> 220</td></tr>
	<tr><td>0.05</td><td>0.8</td><td>0.1125</td><td> 288</td></tr>
	<tr><td>0.05</td><td>0.9</td><td>0.1125</td><td> 400</td></tr>
	<tr><td>0.05</td><td>0.7</td><td>0.1375</td><td> 148</td></tr>
	<tr><td>0.05</td><td>0.8</td><td>0.1375</td><td> 194</td></tr>
	<tr><td>0.05</td><td>0.9</td><td>0.1375</td><td> 268</td></tr>
	<tr><td>0.05</td><td>0.7</td><td>0.1625</td><td> 106</td></tr>
	<tr><td>0.05</td><td>0.8</td><td>0.1625</td><td> 140</td></tr>
	<tr><td>0.05</td><td>0.9</td><td>0.1625</td><td> 192</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="plotting-results">
<h3>1.3. Plotting Results<a class="headerlink" href="#plotting-results" title="Permalink to this heading">#</a></h3>
<p>The data frame <code class="docutils literal notranslate"><span class="pre">experimental_grid</span></code> can be plotted as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">repr.plot.width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">14</span><span class="p">)</span>

<span class="n">t_sample_size_plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">experimental_grid</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">delta</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">overall_n</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">power</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_line</span><span class="p">(</span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme</span><span class="p">(</span>
<span class="w">    </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">),</span>
<span class="w">    </span><span class="n">strip.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">),</span>
<span class="w">    </span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bottom&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">legend.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">margin</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cm&quot;</span><span class="p">)),</span><span class="w"> </span>
<span class="w">    </span><span class="n">legend.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">margin</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cm&quot;</span><span class="p">)),</span>
<span class="w">    </span><span class="n">legend.key.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">unit</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cm&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Response Increase with Experimental Treatment B (%)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Overall Sample Size n&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">coord_cartesian</span><span class="p">(</span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.0375</span><span class="p">,</span><span class="w"> </span><span class="m">0.1625</span><span class="p">),</span><span class="w"> </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">4000</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">4000</span><span class="p">,</span><span class="w"> </span><span class="m">500</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">delta</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">11</span><span class="p">,</span><span class="w"> </span><span class="m">13</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Power&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">ggtitle</span><span class="p">(</span><span class="nf">expression</span><span class="p">(</span><span class="s">&quot;A/B Testing Overall Sample Size Computations with&quot;</span><span class="o">~</span><span class="n">alpha</span><span class="o">~</span><span class="s">&quot;= 0.05&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_color_brewer</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Dark2&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">t_sample_size_plot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/e33428f3fa85ab6a7ceeb8b724124f45d8c7f7448dd051da13e375464acff460.png"><img alt="../_images/e33428f3fa85ab6a7ceeb8b724124f45d8c7f7448dd051da13e375464acff460.png" src="../_images/e33428f3fa85ab6a7ceeb8b724124f45d8c7f7448dd051da13e375464acff460.png" style="width: 840px; height: 480px;" /></a>
</div>
</div>
<div class="exercise admonition" id="lecture5-q1">

<p class="admonition-title"><span class="caption-number">Exercise 17 </span></p>
<section id="exercise-content">
<p>Use the above Power Analysis plot to answer this question.</p>
<p>If we cannot anticipate a large percentage response increase with our experimental version B, compared to control treatment A, what can we state about the overall sample size?</p>
<p><strong>Select the correct option:</strong></p>
<p><strong>A.</strong> If we cannot ensure a large percentage response increase with our experimental version B in mean duration visits, compared to control treatment A, our A/B testing will require <strong>more experimental units</strong>.</p>
<p><strong>B.</strong> If we cannot ensure a large percentage response increase with our experimental version B in mean duration visits, compared to control treatment A, our A/B testing will require <strong>less experimental units</strong>.</p>
</section>
</div>
</section>
<section id="alternative-plotting">
<h3>1.4. Alternative Plotting<a class="headerlink" href="#alternative-plotting" title="Permalink to this heading">#</a></h3>
<p>Suppose your boss tells you there is <strong>available budget</strong> for an A/B testing for an overall simple size up to <span class="math notranslate nohighlight">\(n = 1000\)</span>. You can use <code class="docutils literal notranslate"><span class="pre">pwr.t.test()</span></code> to compute the corresponding levels of power with the following settings:</p>
<ul class="simple">
<li><p><strong>Overall sample sizes</strong> from <span class="math notranslate nohighlight">\(100\)</span> to <span class="math notranslate nohighlight">\(1000\)</span> increasing by <span class="math notranslate nohighlight">\(100\)</span>.</p></li>
<li><p>A single value for <span class="math notranslate nohighlight">\(\alpha = 0.05\)</span> (i.e., the default <strong>significance level</strong>).</p></li>
<li><p>Increases in the response of interest with <span class="math notranslate nohighlight">\(\delta = 0.0375, 0.0625, 0.0875, 0.1125, 0.1375, 0.1625\)</span> in treatment B with respect to treatment A (i.e., increases of 3, 5, 7, 9, 11, and 13%).</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let us obtain all possible setting combinations</span>
<span class="n">sample_size_seq</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">)</span>
<span class="n">experimental_grid_alt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">expand.grid</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">sample_size_seq</span><span class="p">,</span><span class="w"> </span><span class="n">delta</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">experimental_grid_alt</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;alpha&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sample_size&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;delta&quot;</span><span class="p">)</span>
<span class="c1"># Adding a column for power</span>
<span class="n">experimental_grid_alt</span><span class="o">$</span><span class="n">power</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span>
<span class="n">experimental_grid_alt</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 60 × 4</caption>
<thead>
	<tr><th scope=col>alpha</th><th scope=col>sample_size</th><th scope=col>delta</th><th scope=col>power</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;lgl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>0.05</td><td>100</td><td>0.0375</td><td>NA</td></tr>
	<tr><td>0.05</td><td>200</td><td>0.0375</td><td>NA</td></tr>
	<tr><td>0.05</td><td>300</td><td>0.0375</td><td>NA</td></tr>
	<tr><td>0.05</td><td>400</td><td>0.0375</td><td>NA</td></tr>
	<tr><td>0.05</td><td>500</td><td>0.0375</td><td>NA</td></tr>
	<tr><td>0.05</td><td>600</td><td>0.0375</td><td>NA</td></tr>
	<tr><td>0.05</td><td>700</td><td>0.0375</td><td>NA</td></tr>
	<tr><td>0.05</td><td>800</td><td>0.0375</td><td>NA</td></tr>
	<tr><td>0.05</td><td>900</td><td>0.0375</td><td>NA</td></tr>
	<tr><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td></tr>
	<tr><td>0.05</td><td> 200</td><td>0.1625</td><td>NA</td></tr>
	<tr><td>0.05</td><td> 300</td><td>0.1625</td><td>NA</td></tr>
	<tr><td>0.05</td><td> 400</td><td>0.1625</td><td>NA</td></tr>
	<tr><td>0.05</td><td> 500</td><td>0.1625</td><td>NA</td></tr>
	<tr><td>0.05</td><td> 600</td><td>0.1625</td><td>NA</td></tr>
	<tr><td>0.05</td><td> 700</td><td>0.1625</td><td>NA</td></tr>
	<tr><td>0.05</td><td> 800</td><td>0.1625</td><td>NA</td></tr>
	<tr><td>0.05</td><td> 900</td><td>0.1625</td><td>NA</td></tr>
	<tr><td>0.05</td><td>1000</td><td>0.1625</td><td>NA</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Then, we use the function <code class="docutils literal notranslate"><span class="pre">pwr.t.test()</span></code> with all the possible combinations from <code class="docutils literal notranslate"><span class="pre">experimental_grid_alt</span></code>. We use the same value for <code class="docutils literal notranslate"><span class="pre">sigma</span></code>. The elements of <code class="docutils literal notranslate"><span class="pre">pwr.t.test()</span></code> will be:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">d</span></code>: Desired effect size (<span class="math notranslate nohighlight">\(\delta\)</span> divided by <span class="math notranslate nohighlight">\(\sigma = 0.383\)</span>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sig.level</span></code>: Chosen <span class="math notranslate nohighlight">\(\alpha\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n</span></code>: Number of experimental units <strong>PER TREATMENT</strong>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: Type of test (in the A/B testing context we have a <code class="docutils literal notranslate"><span class="pre">two.sample</span></code> test).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">alternative</span></code>: Our hypothesis test is one-sided, thus <code class="docutils literal notranslate"><span class="pre">greater</span></code>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">nrow</span><span class="p">(</span><span class="n">experimental_grid_alt</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1"># Using pwr.t.test() function</span>
<span class="w">  </span><span class="n">sample_size</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">tidy</span><span class="p">(</span><span class="nf">pwr.t.test</span><span class="p">(</span>
<span class="w">    </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">experimental_grid_alt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;delta&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">sigma</span><span class="p">,</span>
<span class="w">    </span><span class="n">sig.level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">experimental_grid_alt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;alpha&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">experimental_grid_alt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sample_size&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="c1"># We divide over 2 given the function&#39;s syntax (subsample size by treatment)</span>
<span class="w">    </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;two.sample&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">alternative</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;greater&quot;</span>
<span class="w">  </span><span class="p">))</span>

<span class="w">  </span><span class="c1"># Recording power</span>
<span class="w">  </span><span class="n">experimental_grid_alt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;power&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample_size</span><span class="o">$</span><span class="n">power</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>The results are shown below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">experimental_grid_alt</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 60 × 4</caption>
<thead>
	<tr><th scope=col>alpha</th><th scope=col>sample_size</th><th scope=col>delta</th><th scope=col>power</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>0.05</td><td>100</td><td>0.0375</td><td>0.1232954</td></tr>
	<tr><td>0.05</td><td>200</td><td>0.0375</td><td>0.1698191</td></tr>
	<tr><td>0.05</td><td>300</td><td>0.0375</td><td>0.2121911</td></tr>
	<tr><td>0.05</td><td>400</td><td>0.0375</td><td>0.2522567</td></tr>
	<tr><td>0.05</td><td>500</td><td>0.0375</td><td>0.2905908</td></tr>
	<tr><td>0.05</td><td>600</td><td>0.0375</td><td>0.3274205</td></tr>
	<tr><td>0.05</td><td>700</td><td>0.0375</td><td>0.3628448</td></tr>
	<tr><td>0.05</td><td>800</td><td>0.0375</td><td>0.3969099</td></tr>
	<tr><td>0.05</td><td>900</td><td>0.0375</td><td>0.4296397</td></tr>
	<tr><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td></tr>
	<tr><td>0.05</td><td> 200</td><td>0.1625</td><td>0.9106871</td></tr>
	<tr><td>0.05</td><td> 300</td><td>0.1625</td><td>0.9783693</td></tr>
	<tr><td>0.05</td><td> 400</td><td>0.1625</td><td>0.9952115</td></tr>
	<tr><td>0.05</td><td> 500</td><td>0.1625</td><td>0.9990070</td></tr>
	<tr><td>0.05</td><td> 600</td><td>0.1625</td><td>0.9998042</td></tr>
	<tr><td>0.05</td><td> 700</td><td>0.1625</td><td>0.9999629</td></tr>
	<tr><td>0.05</td><td> 800</td><td>0.1625</td><td>0.9999932</td></tr>
	<tr><td>0.05</td><td> 900</td><td>0.1625</td><td>0.9999988</td></tr>
	<tr><td>0.05</td><td>1000</td><td>0.1625</td><td>0.9999998</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">t_power_plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">experimental_grid_alt</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_size</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">power</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">delta</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_line</span><span class="p">(</span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme</span><span class="p">(</span>
<span class="w">    </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">),</span>
<span class="w">    </span><span class="n">strip.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">),</span>
<span class="w">    </span><span class="n">legend.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">margin</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cm&quot;</span><span class="p">)),</span><span class="w"> </span>
<span class="w">    </span><span class="n">legend.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">margin</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cm&quot;</span><span class="p">)),</span>
<span class="w">    </span><span class="n">legend.key.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">unit</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cm&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Overall Sample Size n&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Power&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">coord_cartesian</span><span class="p">(</span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">1000</span><span class="p">),</span><span class="w"> </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0.1</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_size_seq</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Response Increase\nwith\nExperimental\nTreatment B (%)&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">ggtitle</span><span class="p">(</span><span class="nf">expression</span><span class="p">(</span><span class="s">&quot;A/B Testing Power Computation with&quot;</span><span class="o">~</span><span class="n">alpha</span><span class="o">~</span><span class="s">&quot;= 0.05&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_color_brewer</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Dark2&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_colour_discrete</span><span class="p">(</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;3%&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;5%&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;7%&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;9%&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;11%&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;13%&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Scale for <span class=" -Color -Color-Green">colour</span> is already present.
Adding another scale for <span class=" -Color -Color-Green">colour</span>, which will replace the existing scale.
</pre></div>
</div>
</div>
</div>
<p>The data frame <code class="docutils literal notranslate"><span class="pre">experimental_grid_alt</span></code> can be plotted as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">t_power_plot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/078b181fd05181be3c364696348ce53dd681b35f9ec6f696c84da468e2c487d7.png"><img alt="../_images/078b181fd05181be3c364696348ce53dd681b35f9ec6f696c84da468e2c487d7.png" src="../_images/078b181fd05181be3c364696348ce53dd681b35f9ec6f696c84da468e2c487d7.png" style="width: 840px; height: 480px;" /></a>
</div>
</div>
<div class="exercise admonition" id="lecture5-q2">

<p class="admonition-title"><span class="caption-number">Exercise 18 </span></p>
<section id="exercise-content">
<p>Use the above Power Analysis plot to answer this question.</p>
<p><strong>Answer TRUE or FALSE:</strong></p>
<p>If we want to use a <strong>small overall sample size <span class="math notranslate nohighlight">\(n\)</span></strong>, we will not struggle to find a decent power level with a response increase of 3% using our experimental treatment.</p>
<p><strong>A.</strong> TRUE</p>
<p><strong>B.</strong> FALSE</p>
</section>
</div>
<div class="exercise admonition" id="lecture5-q3">

<p class="admonition-title"><span class="caption-number">Exercise 19 </span></p>
<section id="exercise-content">
<p>Use the above Power Analysis plot to answer this question.</p>
<p><strong>Answer TRUE or FALSE:</strong></p>
<p><strong>Beginning a response increase of 7% and beyond</strong>, our power levels get <strong>boosted</strong> as we increase our overall sample sizes. This is more evident starting <span class="math notranslate nohighlight">\(n = 400\)</span>.</p>
<p><strong>A.</strong> TRUE</p>
<p><strong>B.</strong> FALSE</p>
</section>
</div>
</section>
</section>
<section id="sample-size-computations-with-click-through-rates">
<h2>2. Sample Size Computations with Click-through Rates<a class="headerlink" href="#sample-size-computations-with-click-through-rates" title="Permalink to this heading">#</a></h2>
<p>So far, our A/B testing sample size computations have been focused on continuous responses. Nonetheless, recall we discussed that A/B testings could involve more than one outcome class. Thus, let us explore sample size computations with a different outcome of interest: <strong>click-through rates (CTRs).</strong></p>
<p>Many A/B testing problems would involve a response which is <strong>binary</strong>. This response is measured as a CTR. Let us review this metric:</p>
<div class="math notranslate nohighlight">
\[\text{CTR}_j = \frac{\text{Total number of clicks on the button of interest in the $j$th treatment page}}{\text{Total number of impressions on the $j$th treatment page}}.\]</div>
<p>This response in the experiment is a proportion. Therefore:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\text{CTR}_A \in [0,1]\)</span> is the CTR of the control treatment A.</p></li>
<li><p><span class="math notranslate nohighlight">\(\text{CTR}_B \in [0,1]\)</span> is the CTR of the experimental treatment B.</p></li>
</ul>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>In the context of a CTR, the sample size is equivalent to the <strong>OVERALL</strong> number of impressions in the A/B testing.</p>
</div>
<p>Since we are using a CTR as an outcome of interest, the function <code class="docutils literal notranslate"><span class="pre">pwr.t.test()</span></code> will not be helpful anymore. Hence, let us explore an alternative method.</p>
<p>Let us start with a simple CTR example for sample size computation. We want to assess whether a tweak to our site would increase the CTR from <span class="math notranslate nohighlight">\(5/1000 = 0.005\)</span> (i.e., <strong>5 clicks per 1000 impressions in treatment A</strong>) to <span class="math notranslate nohighlight">\(7/1000 = 0.007\)</span> (i.e., <strong>7 clicks per 1000 impressions in treatment B</strong>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">control_A_CTR</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">5</span><span class="o">/</span><span class="m">1000</span>
<span class="n">tweak_B_CTR</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">7</span><span class="o">/</span><span class="m">1000</span>
</pre></div>
</div>
</div>
</div>
<p>Unlike a continuous response, <strong>we do not need to compute <span class="math notranslate nohighlight">\(\sigma\)</span> nor a mean for treatment A.</strong> However, we need to compute the <strong>effect size</strong> <span class="math notranslate nohighlight">\(h\)</span> for two proportions (i.e., two CTRs in an A/B testing). We will use the function <code class="docutils literal notranslate"><span class="pre">ES.h()</span></code> for this purpose. Its first argument will be the CTR for the experimental treatment B and and the second one for the control treatment A.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">CTR_effect_size</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span><span class="n">tweak_B_CTR</span><span class="p">,</span><span class="w"> </span><span class="n">control_A_CTR</span><span class="p">)</span>
<span class="nf">round</span><span class="p">(</span><span class="n">CTR_effect_size</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">0.026</div></div>
</div>
<section id="an-interlude-on-the-arcsine-transformation-for-the-effect-size">
<h3>2.1. An Interlude on the Arcsine Transformation for the Effect Size<a class="headerlink" href="#an-interlude-on-the-arcsine-transformation-for-the-effect-size" title="Permalink to this heading">#</a></h3>
<p>We are computing the effect size <span class="math notranslate nohighlight">\(h\)</span> as an <strong>arcsine transformation</strong>:</p>
<div class="math notranslate nohighlight">
\[\text{Effect Size } h = \left[ 2 \times \arcsin{\left(\sqrt{\text{CTR}_B} \right)} \big] - \big[ 2 \times \arcsin{\left(\sqrt{\text{CTR}_A}\right)} \right].\]</div>
<div class="important admonition">
<p class="admonition-title">What is this transformation graphically doing?</p>
<p><strong>In the below plot</strong>, note that the <span class="math notranslate nohighlight">\(x\)</span>-axis shows three equally-spaced <span class="math notranslate nohighlight">\(\delta_{\text{CTR}}\)</span> segments (denoted by vertical red dashed lines).</p>
<p>The arcsine transformation will allocate:</p>
<ul class="simple">
<li><p>a smaller <strong>transformed effect size on the <span class="math notranslate nohighlight">\(y\)</span>-axis</strong> between two CTRs  (denoted by horizontal purple dashed lines) as we get close to the middle of the <span class="math notranslate nohighlight">\(x\)</span>-axis (i.e., <span class="math notranslate nohighlight">\(0.5\)</span>),</p></li>
<li><p>and larger <strong>transformed effect sizes on the <span class="math notranslate nohighlight">\(y\)</span>-axis</strong> as we get closer to the <span class="math notranslate nohighlight">\(x\)</span>-axis extremes (either <span class="math notranslate nohighlight">\(0\)</span> or <span class="math notranslate nohighlight">\(1\)</span>).</p></li>
</ul>
<p>Moreover, note that the <strong>transformed effect size on the <span class="math notranslate nohighlight">\(y\)</span>-axis</strong> between</p>
<div class="math notranslate nohighlight">
\[\delta_{\text{CTR}} = \text{CTR}_B - \text{CTR}_A = 0.1 - 0.05 = 0.05\]</div>
<p>is equal to the one from</p>
<div class="math notranslate nohighlight">
\[\delta_{\text{CTR}} = \text{CTR}_B - \text{CTR}_A = 0.95 - 0.9 = 0.05.\]</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">effect_size_plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_function</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;blue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ES.h</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">xlab</span><span class="p">(</span><span class="s">&quot;CTR&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">ylab</span><span class="p">(</span><span class="s">&quot;Transformation&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_segment</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">xend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="n">yend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)),</span>
<span class="w">    </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;dashed&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_segment</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">xend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">yend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)),</span>
<span class="w">    </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;dashed&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_segment</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">xend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="n">yend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)),</span>
<span class="w">    </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;purple&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;dashed&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_segment</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">xend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">yend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)),</span>
<span class="w">    </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;purple&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;dashed&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_segment</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">xend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">yend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)),</span>
<span class="w">    </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;dashed&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_segment</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.55</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">xend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.55</span><span class="p">,</span><span class="w"> </span><span class="n">yend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.55</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)),</span>
<span class="w">    </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;dashed&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_segment</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">xend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">yend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)),</span>
<span class="w">    </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;purple&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;dashed&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_segment</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.55</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">xend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.55</span><span class="p">,</span><span class="w"> </span><span class="n">yend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.55</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)),</span>
<span class="w">    </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;purple&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;dashed&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_segment</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.9</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">xend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.9</span><span class="p">,</span><span class="w"> </span><span class="n">yend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.9</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)),</span>
<span class="w">    </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;dashed&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_segment</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.95</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">xend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.95</span><span class="p">,</span><span class="w"> </span><span class="n">yend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.95</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)),</span>
<span class="w">    </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;dashed&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_segment</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.9</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">xend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.9</span><span class="p">,</span><span class="w"> </span><span class="n">yend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.9</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)),</span>
<span class="w">    </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;purple&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;dashed&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_segment</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.95</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">xend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.95</span><span class="p">,</span><span class="w"> </span><span class="n">yend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.95</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)),</span>
<span class="w">    </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;purple&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;dashed&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_x_continuous</span><span class="p">(</span>
<span class="w">    </span><span class="n">limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.25</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0.55</span><span class="p">,</span><span class="w"> </span><span class="m">0.75</span><span class="p">,</span><span class="w"> </span><span class="m">0.9</span><span class="p">,</span><span class="w"> </span><span class="m">0.95</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span>
<span class="w">    </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.25</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0.55</span><span class="p">,</span><span class="w"> </span><span class="m">0.75</span><span class="p">,</span><span class="w"> </span><span class="m">0.9</span><span class="p">,</span><span class="w"> </span><span class="m">0.95</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_y_continuous</span><span class="p">(</span>
<span class="w">    </span><span class="n">limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">3.25</span><span class="p">),</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.55</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.9</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.95</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="m">3</span><span class="p">),</span>
<span class="w">    </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.55</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.9</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="nf">ES.h</span><span class="p">(</span><span class="m">0.95</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme</span><span class="p">(</span>
<span class="w">    </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">ggtitle</span><span class="p">(</span><span class="s">&quot;Arcsine Transformation Comparison&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">effect_size_plot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/ae11b5cf4d14a6a175e5390ab158eeaae77da8d3733ccf583e39bcfc74c9e1f8.png"><img alt="../_images/ae11b5cf4d14a6a175e5390ab158eeaae77da8d3733ccf583e39bcfc74c9e1f8.png" src="../_images/ae11b5cf4d14a6a175e5390ab158eeaae77da8d3733ccf583e39bcfc74c9e1f8.png" style="width: 840px; height: 480px;" /></a>
</div>
</div>
<div class="hint admonition">
<p class="admonition-title">Why is this effect behaviour happening in the above plot?</p>
<p>This is heavily related to the <strong>statistic’s standard error</strong> of the corresponding <strong>two-proportion hypothesis <span class="math notranslate nohighlight">\(Z\)</span>-test</strong>. <strong>For our previous practical example</strong>, we want to assess whether an experimental tweak in the website would increase from <span class="math notranslate nohighlight">\(\text{CTR}_A = 0.005\)</span> to <span class="math notranslate nohighlight">\(\text{CTR}_B = 0.007\)</span>, i.e.,</p>
<div class="math notranslate nohighlight">
\[\delta_{\text{CTR}} = \text{CTR}_B - \text{CTR}_A = 0.002;\]</div>
<p>with the following hypotheses</p>
<div class="math notranslate nohighlight">
\[H_0: \delta_{\text{CTR}} &lt; 0.002\]</div>
<div class="math notranslate nohighlight">
\[H_a: \delta_{\text{CTR}} \geq 0.002.\]</div>
<p>Note this <strong>two-proportion <span class="math notranslate nohighlight">\(Z\)</span>-test</strong> has the following <strong>test statistic</strong>:</p>
<div class="math notranslate nohighlight">
\[Z = \frac{\hat{\delta}_{\text{CTR}} - 0.002}{\sqrt{\frac{\hat{\text{CTR}}_A (1 - \hat{\text{CTR}}_A)}{n/2} + \frac{\hat{\text{CTR}}_B (1 - \hat{\text{CTR}}_B)}{n/2}}} = \frac{\hat{\delta}_{\text{CTR}} - 0.002}{\text{SE}\left(\hat{\delta}_{\text{CTR}}
\right)}.\]</div>
<p>Now, this standard error <span class="math notranslate nohighlight">\(\text{SE}\left(\hat{\delta_{\text{CTR}}}\right)\)</span> <strong>will behave differently</strong> depending on where we locate our baseline <span class="math notranslate nohighlight">\(\text{CTR}_A\)</span> on the <span class="math notranslate nohighlight">\([0, 1]\)</span> range, <strong>even with the same <span class="math notranslate nohighlight">\(\delta_{\text{CTR}}\)</span>!</strong></p>
</div>
<p>Let us plot the behaviour of <span class="math notranslate nohighlight">\(\text{SE}\left(\hat{\delta}_{\text{CTR}}\right)\)</span> under different scenarios with a <strong>baseline</strong></p>
<div class="math notranslate nohighlight">
\[\text{CTR}_A = 0.05, 0.15, 0.25, 0.35, 0.45, 0.55, 0.65, 0.75, 0.85, 0.95\]</div>
<p>and an overall sample size</p>
<div class="math notranslate nohighlight">
\[n = 50, 100, 200, 500, 1000.\]</div>
<p>The below code will create the corresponding combination grid.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>In each scenario, we consider a</p>
<div class="math notranslate nohighlight">
\[\delta_{\text{CTR}} = \text{CTR}_B - \text{CTR}_A = 0.05.\]</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">CTR_A</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="m">0.15</span><span class="p">,</span><span class="w"> </span><span class="m">0.25</span><span class="p">,</span><span class="w"> </span><span class="m">0.35</span><span class="p">,</span><span class="w"> </span><span class="m">0.45</span><span class="p">,</span><span class="w"> </span><span class="m">0.55</span><span class="p">,</span><span class="w"> </span><span class="m">0.65</span><span class="p">,</span><span class="w"> </span><span class="m">0.75</span><span class="p">,</span><span class="w"> </span><span class="m">0.85</span><span class="p">,</span><span class="w"> </span><span class="m">0.95</span><span class="p">)</span>
<span class="n">overall_n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">200</span><span class="p">,</span><span class="w"> </span><span class="m">500</span><span class="p">,</span><span class="w"> </span><span class="m">1000</span><span class="p">)</span>
<span class="n">SE_grid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">expand.grid</span><span class="p">(</span><span class="n">CTR_A</span><span class="p">,</span><span class="w"> </span><span class="n">overall_n</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">SE_grid</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;CTR_A&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;overall_n&quot;</span><span class="p">)</span>
<span class="n">SE_grid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">SE_grid</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">CTR_B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CTR_A</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="n">SE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(((</span><span class="n">CTR_A</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">CTR_A</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">overall_n</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="n">CTR_B</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">CTR_B</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">overall_n</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">2</span><span class="p">))))</span>

<span class="n">SE_grid</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 50 × 4</caption>
<thead>
	<tr><th scope=col>CTR_A</th><th scope=col>overall_n</th><th scope=col>CTR_B</th><th scope=col>SE</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>0.05</td><td>50</td><td>0.1</td><td>0.07416198</td></tr>
	<tr><td>0.15</td><td>50</td><td>0.2</td><td>0.10723805</td></tr>
	<tr><td>0.25</td><td>50</td><td>0.3</td><td>0.12609520</td></tr>
	<tr><td>0.35</td><td>50</td><td>0.4</td><td>0.13674794</td></tr>
	<tr><td>0.45</td><td>50</td><td>0.5</td><td>0.14106736</td></tr>
	<tr><td>0.55</td><td>50</td><td>0.6</td><td>0.13964240</td></tr>
	<tr><td>0.65</td><td>50</td><td>0.7</td><td>0.13228757</td></tr>
	<tr><td>0.75</td><td>50</td><td>0.8</td><td>0.11789826</td></tr>
	<tr><td>0.85</td><td>50</td><td>0.9</td><td>0.09327379</td></tr>
	<tr><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td></tr>
	<tr><td>0.15</td><td>1000</td><td>0.2</td><td>0.023979158</td></tr>
	<tr><td>0.25</td><td>1000</td><td>0.3</td><td>0.028195744</td></tr>
	<tr><td>0.35</td><td>1000</td><td>0.4</td><td>0.030577770</td></tr>
	<tr><td>0.45</td><td>1000</td><td>0.5</td><td>0.031543621</td></tr>
	<tr><td>0.55</td><td>1000</td><td>0.6</td><td>0.031224990</td></tr>
	<tr><td>0.65</td><td>1000</td><td>0.7</td><td>0.029580399</td></tr>
	<tr><td>0.75</td><td>1000</td><td>0.8</td><td>0.026362853</td></tr>
	<tr><td>0.85</td><td>1000</td><td>0.9</td><td>0.020856654</td></tr>
	<tr><td>0.95</td><td>1000</td><td>1.0</td><td>0.009746794</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Let us check how this standard error graphically behaves across different <strong>baseline <span class="math notranslate nohighlight">\(\text{CTR}_A\)</span></strong> by overall sample size <span class="math notranslate nohighlight">\(n\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">SE_plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">SE_grid</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CTR_A</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SE</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">overall_n</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_line</span><span class="p">(</span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme</span><span class="p">(</span>
<span class="w">    </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">),</span>
<span class="w">    </span><span class="n">strip.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">),</span>
<span class="w">    </span><span class="n">legend.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">margin</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cm&quot;</span><span class="p">)),</span><span class="w"> </span>
<span class="w">    </span><span class="n">legend.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">margin</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cm&quot;</span><span class="p">)),</span>
<span class="w">    </span><span class="n">legend.key.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">unit</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cm&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">expression</span><span class="p">(</span><span class="s">&quot;Baseline&quot;</span><span class="o">~</span><span class="n">CTR</span><span class="p">[</span><span class="n">A</span><span class="p">]),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Standard Error&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Overall Sample Size n&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">ggtitle</span><span class="p">(</span><span class="s">&quot;Standard Error Behaviour in a Two-proportion Hypothesis Z-test&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nf">scale_x_continuous</span><span class="p">(</span>
<span class="w">    </span><span class="n">limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0.1</span><span class="p">),</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_y_continuous</span><span class="p">(</span>
<span class="w">    </span><span class="n">limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0.15</span><span class="p">),</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0.15</span><span class="p">,</span><span class="w"> </span><span class="m">0.03</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_color_brewer</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Dark2&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">SE_plot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/c2d564058504b3680ca8fbc0c3db41dba6af1df51c95c1f97e61b4c384f543b8.png"><img alt="../_images/c2d564058504b3680ca8fbc0c3db41dba6af1df51c95c1f97e61b4c384f543b8.png" src="../_images/c2d564058504b3680ca8fbc0c3db41dba6af1df51c95c1f97e61b4c384f543b8.png" style="width: 840px; height: 480px;" /></a>
</div>
</div>
<div class="hint admonition">
<p class="admonition-title">What is the main takeaway from this standard error plot?</p>
<p>We can see that the standard error of the test statistic approaches a maximum point around the middle-end of the range <span class="math notranslate nohighlight">\([0, 1]\)</span> on the <span class="math notranslate nohighlight">\(x\)</span>-axis. Furthermore, if we increase the overall sample size <span class="math notranslate nohighlight">\(n\)</span>, we can bend the standard error curve.</p>
<p>Having said all this, we can state the following:</p>
<ul class="simple">
<li><p>A <strong>smaller transformed effect size</strong> in CTR Power Analysis would be associated with <strong>larger standard errors and CTRs jointly around <span class="math notranslate nohighlight">\(0.5\)</span></strong>; thus, it is in our best interest to increase our overall sample size <span class="math notranslate nohighlight">\(n\)</span> so we can overcome a large uncertainty in our estimation.</p></li>
<li><p>A <strong>larger transformed effect size</strong> in CTR Power Analysis would be associated with <strong>smaller standard errors and CTRs jointly closer to the extremes <span class="math notranslate nohighlight">\(0\)</span> or <span class="math notranslate nohighlight">\(1\)</span></strong>; thus, our required overall sample size <span class="math notranslate nohighlight">\(n\)</span> would be smaller given this small uncertainty in our estimation.</p></li>
</ul>
</div>
</section>
<section id="using-function-pwr-2p-test">
<h3>2.2. Using Function <code class="docutils literal notranslate"><span class="pre">pwr.2p.test()</span></code><a class="headerlink" href="#using-function-pwr-2p-test" title="Permalink to this heading">#</a></h3>
<p>As in any sample size computation, we need to set up the <strong>significance level</strong> <span class="math notranslate nohighlight">\(\alpha\)</span> and <strong>power</strong> <span class="math notranslate nohighlight">\(1 - \beta\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.05</span>
<span class="n">pow</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.8</span>
</pre></div>
</div>
</div>
</div>
<p>Function <code class="docutils literal notranslate"><span class="pre">pwr.2p.test()</span></code> is part of the library <code class="docutils literal notranslate"><span class="pre">pwr</span></code>. It needs the following arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">h</span></code>: Desired <strong>effect size</strong> using the arcsine transformation <code class="docutils literal notranslate"><span class="pre">CTR_effect_size</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sig.level</span></code>: Chosen <span class="math notranslate nohighlight">\(\alpha\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">power</span></code>: Chosen power <span class="math notranslate nohighlight">\(1 - \beta\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">alternative</span></code>: Our hypothesis test is <strong>one-sided</strong>, thus <code class="docutils literal notranslate"><span class="pre">greater</span></code>.</p></li>
</ul>
<p>The function will return the required sample size <strong>by treatment</strong> (i.e., the required number of impressions <strong>by treatment</strong>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">CTR_test</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">pwr.2p.test</span><span class="p">(</span>
<span class="w">  </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CTR_effect_size</span><span class="p">,</span>
<span class="w">  </span><span class="n">sig.level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span>
<span class="w">  </span><span class="n">power</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow</span><span class="p">,</span>
<span class="w">  </span><span class="n">alternative</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;greater&quot;</span>
<span class="p">)</span>
<span class="n">CTR_test</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     Difference of proportion power calculation for binomial distribution (arcsine transformation) 

              h = 0.02598837
              n = 18307.96
      sig.level = 0.05
          power = 0.8
    alternative = greater

NOTE: same sample sizes
</pre></div>
</div>
</div>
</div>
<p>Once we have checked how to use <code class="docutils literal notranslate"><span class="pre">pwr.2p.test()</span></code>, suppose your boss requires a sample size computation analysis with eight different control CTRs for treatment A:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">n_lev</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">8</span>
<span class="n">CTR_control_A</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">n_lev</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">200</span>
<span class="n">CTR_control_A</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>0.005</li><li>0.01</li><li>0.015</li><li>0.02</li><li>0.025</li><li>0.03</li><li>0.035</li><li>0.04</li></ol>
</div></div>
</div>
<p>Moreover, they also want to evaluate the impact of eight different CTR increases <span class="math notranslate nohighlight">\(\delta_{\text{CTR}}\)</span> <strong>when using treatment B</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">CTR_delta</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">((</span><span class="m">1</span><span class="o">:</span><span class="n">n_lev</span><span class="p">)</span><span class="o">/</span><span class="m">400</span><span class="p">)</span>
<span class="n">CTR_delta</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>0.0025</li><li>0.005</li><li>0.0075</li><li>0.01</li><li>0.0125</li><li>0.015</li><li>0.0175</li><li>0.02</li></ol>
</div></div>
</div>
<p>Therefore, for a single <span class="math notranslate nohighlight">\(\alpha\)</span> and power <span class="math notranslate nohighlight">\(1 - \beta\)</span>, there will be 64 possible combinations of settings, as shown below in <code class="docutils literal notranslate"><span class="pre">CTR_experimental_grid</span></code>. We use this grid to get the corresponding <strong>OVERALL</strong> A/B testing sample size via <code class="docutils literal notranslate"><span class="pre">pwr.2p.test()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">CTR_experimental_grid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">expand.grid</span><span class="p">(</span><span class="n">CTR_control_A</span><span class="p">,</span><span class="w"> </span><span class="n">CTR_delta</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">CTR_experimental_grid</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;CTR_control_A&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CTR_delta&quot;</span><span class="p">)</span>
<span class="n">CTR_experimental_grid</span><span class="o">$</span><span class="n">sample_size</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span>

<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">nrow</span><span class="p">(</span><span class="n">CTR_experimental_grid</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">CTR_experimental_grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sample_size&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">ceiling</span><span class="p">(</span><span class="nf">pwr.2p.test</span><span class="p">(</span>
<span class="w">    </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span>
<span class="w">      </span><span class="n">CTR_experimental_grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CTR_control_A&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="n">CTR_experimental_grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CTR_delta&quot;</span><span class="p">],</span>
<span class="w">      </span><span class="n">CTR_experimental_grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CTR_control_A&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">),</span>
<span class="w">    </span><span class="n">sig.level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span>
<span class="w">    </span><span class="n">power</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow</span><span class="p">,</span>
<span class="w">    </span><span class="n">alternative</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;greater&quot;</span>
<span class="w">  </span><span class="p">)</span><span class="o">$</span><span class="n">n</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">CTR_experimental_grid</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 64 × 3</caption>
<thead>
	<tr><th scope=col>CTR_control_A</th><th scope=col>CTR_delta</th><th scope=col>sample_size</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>0.005</td><td>0.0025</td><td> 24330</td></tr>
	<tr><td>0.010</td><td>0.0025</td><td> 43880</td></tr>
	<tr><td>0.015</td><td>0.0025</td><td> 63162</td></tr>
	<tr><td>0.020</td><td>0.0025</td><td> 82226</td></tr>
	<tr><td>0.025</td><td>0.0025</td><td>101086</td></tr>
	<tr><td>0.030</td><td>0.0025</td><td>119742</td></tr>
	<tr><td>0.035</td><td>0.0025</td><td>138196</td></tr>
	<tr><td>0.040</td><td>0.0025</td><td>156452</td></tr>
	<tr><td>0.005</td><td>0.0050</td><td>  7154</td></tr>
	<tr><td>⋮</td><td>⋮</td><td>⋮</td></tr>
	<tr><td>0.040</td><td>0.0175</td><td>3716</td></tr>
	<tr><td>0.005</td><td>0.0200</td><td> 800</td></tr>
	<tr><td>0.010</td><td>0.0200</td><td>1132</td></tr>
	<tr><td>0.015</td><td>0.0200</td><td>1446</td></tr>
	<tr><td>0.020</td><td>0.0200</td><td>1750</td></tr>
	<tr><td>0.025</td><td>0.0200</td><td>2046</td></tr>
	<tr><td>0.030</td><td>0.0200</td><td>2338</td></tr>
	<tr><td>0.035</td><td>0.0200</td><td>2626</td></tr>
	<tr><td>0.040</td><td>0.0200</td><td>2908</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Now, we might wonder: <strong>how do we communicate this whole analysis?</strong></p>
<p>We have huge sample sizes above <span class="math notranslate nohighlight">\(100,000\)</span> and others below <span class="math notranslate nohighlight">\(5,000\)</span>. The answer will be in a <strong>clever plotting arrangement</strong>!</p>
<p>The plot below shows the eight values of <span class="math notranslate nohighlight">\(\delta_{\text{CTR}} = \text{CTR}_B - \text{CTR}_A\)</span> on the <span class="math notranslate nohighlight">\(x\)</span>-axis. Moreover, the <span class="math notranslate nohighlight">\(y\)</span>-axis for sample size <span class="math notranslate nohighlight">\(n\)</span> has a primary logarithmic scale on the base 10 on the left-hand side, and the original scale for <span class="math notranslate nohighlight">\(n\)</span> on the right-hand side.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>This plotting arrangement on the <span class="math notranslate nohighlight">\(y\)</span>-axis allows us to compare sample sizes with <strong>DIFFERENT ORDERS OF MAGNITUDE</strong>.</p>
</div>
<p>Finally, the legend on a colour scale incorporates the different control CTRs for treatment A by <span class="math notranslate nohighlight">\(\delta_{\text{CTR}}\)</span> value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">colour_scale</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">scales</span><span class="o">::</span><span class="nf">seq_gradient_pal</span><span class="p">(</span><span class="s">&quot;blue&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Lab&quot;</span><span class="p">)(</span><span class="nf">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">length.out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_lev</span><span class="p">))</span>
<span class="n">breaks_y_axis</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span>
<span class="w">  </span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="m">5000</span><span class="p">,</span><span class="w"> </span><span class="m">10000</span><span class="p">,</span><span class="w"> </span><span class="m">15000</span><span class="p">,</span><span class="w"> </span><span class="m">20000</span><span class="p">,</span>
<span class="w">  </span><span class="m">30000</span><span class="p">,</span><span class="w"> </span><span class="m">50000</span><span class="p">,</span><span class="w"> </span><span class="m">70000</span><span class="p">,</span><span class="w"> </span><span class="m">100000</span><span class="p">,</span><span class="w"> </span><span class="m">150000</span><span class="p">,</span><span class="w"> </span><span class="m">200000</span>
<span class="p">)</span>

<span class="n">CTR_sample_size_plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">CTR_experimental_grid</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CTR_delta</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_size</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">CTR_control_A</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">breaks_y_axis</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;dotted&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_y_continuous</span><span class="p">(</span>
<span class="w">    </span><span class="n">trans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;log10&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">breaks_y_axis</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="nf">log10</span><span class="p">(</span><span class="n">breaks_y_axis</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">),</span>
<span class="w">    </span><span class="n">sec.axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sec_axis</span><span class="p">(</span><span class="o">~</span><span class="n">.</span><span class="p">,</span>
<span class="w">      </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Required Overall n&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">breaks_y_axis</span><span class="p">,</span>
<span class="w">      </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scales</span><span class="o">::</span><span class="nf">comma</span><span class="p">(</span><span class="n">breaks_y_axis</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">xlab</span><span class="p">(</span><span class="nf">expression</span><span class="p">(</span><span class="s">&quot;Experimental CTR Increase&quot;</span><span class="o">~</span><span class="n">delta</span><span class="p">[</span><span class="s">&quot;CTR&quot;</span><span class="p">]))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">ylab</span><span class="p">(</span><span class="s">&quot;Required Overall n (Base 10 Log-Scale)&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_colour_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colour_scale</span><span class="p">,</span><span class="w"> </span><span class="n">guide</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">guide_legend</span><span class="p">(</span><span class="n">reverse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;CTR Control A&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme</span><span class="p">(</span>
<span class="w">    </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">),</span>
<span class="w">    </span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;right&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">legend.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">margin</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cm&quot;</span><span class="p">)),</span><span class="w"> </span>
<span class="w">    </span><span class="n">legend.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">margin</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cm&quot;</span><span class="p">)),</span>
<span class="w">    </span><span class="n">legend.key.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">unit</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;cm&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="n">legend.box.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">margin</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">ggtitle</span><span class="p">(</span><span class="nf">expression</span><span class="p">(</span><span class="s">&quot;A/B Testing Overall Required Impressions with&quot;</span><span class="o">~</span><span class="n">alpha</span><span class="o">~</span><span class="s">&quot;= 0.05&quot;</span><span class="o">~</span><span class="s">&quot;and Power = 0.8&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CTR_delta</span><span class="p">)</span><span class="w"> </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">CTR_sample_size_plot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/288b33a2c0f8e5d8b06cebd64ffa8b214444065eb008eb428362c87e7da58da7.png"><img alt="../_images/288b33a2c0f8e5d8b06cebd64ffa8b214444065eb008eb428362c87e7da58da7.png" src="../_images/288b33a2c0f8e5d8b06cebd64ffa8b214444065eb008eb428362c87e7da58da7.png" style="width: 840px; height: 480px;" /></a>
</div>
</div>
<div class="hint admonition">
<p class="admonition-title">What is the main takeaway from this sample size plot?</p>
<p>We are seeing the arcsine transformation in action here for the effect size via the baseline <span class="math notranslate nohighlight">\(\text{CTR}_A\)</span>. It is susceptible to this baseline <span class="math notranslate nohighlight">\(\text{CTR}_A\)</span> but also to small increases <span class="math notranslate nohighlight">\(\delta_{\text{CTR}}\)</span>.</p>
</div>
<p><strong>So, where are we standing with these CTR results?</strong></p>
<p>Firstly, we might be running the experiment for a long time. Therefore, <strong>can we stop the A/B testing earlier once we see a significant result?</strong> Let us explore <strong>early stopping</strong>.</p>
</section>
</section>
<section id="early-stopping-in-a-b-testing">
<h2>3. Early Stopping in A/B Testing<a class="headerlink" href="#early-stopping-in-a-b-testing" title="Permalink to this heading">#</a></h2>
<p>We will begin with a sample size computation to elaborate on early stopping in A/B testing. Suppose our current site (i.e., <strong>control treatment A</strong>) has a <span class="math notranslate nohighlight">\(\text{CTR}_A\)</span> of 3%. Our team has developed a tweak website layout (i.e., <strong>experimental treatment B</strong>).</p>
<p><strong>We are very optimistic that the tweak to the site could get us to 4.5% CTR, making a solid business case.</strong> Hence, before conducting the corresponding A/B testing, we will power it accordingly via <code class="docutils literal notranslate"><span class="pre">pwr.2p.test()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">control_ctr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.03</span>
<span class="n">tweak_ctr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.045</span>
<span class="n">alpha</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.05</span>
<span class="n">pow</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.8</span>

<span class="n">n_AB</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">ceiling</span><span class="p">(</span>
<span class="w">  </span><span class="nf">pwr.2p.test</span><span class="p">(</span>
<span class="w">    </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ES.h</span><span class="p">(</span><span class="n">tweak_ctr</span><span class="p">,</span><span class="w"> </span><span class="n">control_ctr</span><span class="p">),</span>
<span class="w">    </span><span class="n">sig.level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span>
<span class="w">    </span><span class="n">power</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow</span><span class="p">,</span>
<span class="w">    </span><span class="n">alternative</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;greater&quot;</span>
<span class="w">  </span><span class="p">)</span><span class="o">$</span><span class="n">n</span>
<span class="p">)</span>
<span class="n">n_AB</span><span class="w"> </span><span class="c1"># Overall sample size</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">3930</div></div>
</div>
<section id="introduction-to-peeking">
<h3>3.1. Introduction to Peeking<a class="headerlink" href="#introduction-to-peeking" title="Permalink to this heading">#</a></h3>
<p>We obtain an <strong>OVERALL</strong> sample size of <span class="math notranslate nohighlight">\(n = 3930\)</span>. That is a lot of visitors!</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><strong>If we are running this experiment online while randomizing the experimental units in real-time</strong>, we presumably have access to the data as it is being collected. So we can check the state of our data collection as much as we want throughout the whole A/B testing. <strong>This is called PEEKING.</strong></p>
</div>
<p>Moreover, if you can peek at the data as much as you want in real-time, you might be tempted to <strong>EARLY STOP</strong> the A/B testing. Hence, <strong>if we keep performing the corresponding hypothesis testing every time we peek at the process</strong>, can we stop the experiment earlier before collecting the total sample size <span class="math notranslate nohighlight">\(n = 3930\)</span>?</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Peeking in A/B testing still involves computing your overall sample size, call it <span class="math notranslate nohighlight">\(n_{\text{max}}\)</span>, before starting the experiment. <strong>If at some peek your UPDATED test statistic hits significance before we accrue all <span class="math notranslate nohighlight">\(n_{\text{max}}\)</span> experimental units, then A/B testing randomization and data collection will stop.</strong></p>
</div>
<p>By appealing to the previous logic, as soon as we are convinced that the experimental version of the site is more profitable than the control, we <strong>early stop</strong> the A/B testing and serve the experimental version to all visitors.</p>
<p>Again, simulation will be our friend to <strong>illustrate</strong> and <strong>practice</strong> the concept of <strong>peeking</strong>. Function <code class="docutils literal notranslate"><span class="pre">sim_monitor_track()</span></code> simulates an A/B testing for comparing CTRs with two website versions as follows:</p>
<ul class="simple">
<li><p>The function <strong>sequentially</strong> generates <strong>independent</strong> visitors/impressions (i.e., <strong>experimental units</strong>), one by one, and <strong>randomly</strong> allocates them to either treatment A (control) or B (experimental tweak).</p></li>
<li><p>Moreover, it generates the <strong>experimental unit’s response</strong> (click or non-click) based on the population CTRs: <span class="math notranslate nohighlight">\(\text{CTR}_A\)</span> and <span class="math notranslate nohighlight">\(\text{CTR}_B\)</span>.</p></li>
<li><p>Once each experimental unit has been recruited and their data has been collected, we <strong>compute/update</strong> the corresponding <span class="math notranslate nohighlight">\(z\)</span>-statistic and evaluate whether we reach significance or not (i.e., we conclude that <span class="math notranslate nohighlight">\(\text{CTR}_B &gt; \text{CTR}_A\)</span> at a significance level <span class="math notranslate nohighlight">\(\alpha\)</span>).</p></li>
<li><p>If we reach significance, the A/B testing will <strong>stop before reaching the projected overall sample size <span class="math notranslate nohighlight">\(n_{\text{max}}\)</span></strong>.</p></li>
</ul>
<p>This function needs three arguments: <code class="docutils literal notranslate"><span class="pre">n_max</span></code> (projected maximum overall sample size <span class="math notranslate nohighlight">\(n_{\text{max}}\)</span>), <code class="docutils literal notranslate"><span class="pre">CTR_A</span></code> (population <span class="math notranslate nohighlight">\(\text{CTR}_A\)</span>), and <code class="docutils literal notranslate"><span class="pre">CTR_B</span></code> (population <span class="math notranslate nohighlight">\(\text{CTR}_B\)</span>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">sim_monitor_track</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">n_max</span><span class="p">,</span><span class="w"> </span><span class="n">CTR_A</span><span class="p">,</span><span class="w"> </span><span class="n">CTR_B</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1"># Significance level in A/B testing</span>
<span class="w">  </span><span class="n">alpha</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.05</span>

<span class="w">  </span><span class="c1"># Data to record in each iteration to compute the z-statistic</span>
<span class="w">  </span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
<span class="w">  </span><span class="n">z</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c1"># No test statistic at the beginning of the A/B testing</span>
<span class="w">  </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c1"># No visitors at the beginning of the A/B testing</span>

<span class="w">  </span><span class="c1"># Recordings of z statistics throughout the A/B testing</span>
<span class="w">  </span><span class="n">z_opt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">n_max</span><span class="p">)</span>

<span class="w">  </span><span class="c1"># We will recruit A/B testing visitors within the loop</span>
<span class="w">  </span><span class="c1"># The experiment will last while we do not have a significant result</span>
<span class="w">  </span><span class="c1"># AND we do not reach the maximum number of experimental units (n_max)</span>
<span class="w">  </span><span class="nf">while </span><span class="p">((</span><span class="n">z</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nf">qnorm</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">alpha</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_max</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c1"># Increasing the number of recruited visitors</span>

<span class="w">    </span><span class="c1"># Randomize the visitor to treatment A (0) or B (1)</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="m">0</span><span class="o">:</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
<span class="w">    </span><span class="c1"># See if they click on the link (1) or not (0)</span>
<span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rbinom</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">CTR_A</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">CTR_B</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># Update data table and recompute z-statistic</span>
<span class="w">    </span><span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span>

<span class="w">    </span><span class="c1"># Computing z-statistic</span>
<span class="w">    </span><span class="nf">if </span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">z</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">])</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">]))</span><span class="w"> </span><span class="o">/</span>
<span class="w">        </span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">data</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">z_opt</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="c1"># Recording new z-statistic</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="nf">return</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z_opt</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>We will execute this function <code class="docutils literal notranslate"><span class="pre">4</span></code> times (i.e., we will simulate four A/B testings). Their outputs will be the computed <strong><span class="math notranslate nohighlight">\(z\)</span>-statistic sequences</strong> throughout each experiment. We will use <code class="docutils literal notranslate"><span class="pre">n_max</span> <span class="pre">=</span> <span class="pre">3930</span></code>, <code class="docutils literal notranslate"><span class="pre">CTR_A</span> <span class="pre">=</span> <span class="pre">0.03</span></code>, and <code class="docutils literal notranslate"><span class="pre">CTR_B</span> <span class="pre">=</span> <span class="pre">0.045</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">set.seed</span><span class="p">(</span><span class="m">554</span><span class="p">)</span>

<span class="n">n_sim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">4</span>

<span class="n">z_sim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">n_AB</span><span class="p">,</span><span class="w"> </span><span class="n">n_sim</span><span class="p">)</span>

<span class="nf">for</span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">n_sim</span><span class="p">){</span>
<span class="w">  </span><span class="n">z_sim</span><span class="p">[,</span><span class="w"> </span><span class="n">m</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sim_monitor_track</span><span class="p">(</span><span class="n">n_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3930</span><span class="p">,</span><span class="w"> </span><span class="n">CTR_A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.03</span><span class="p">,</span><span class="w"> </span><span class="n">CTR_B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.045</span><span class="p">)</span><span class="o">$</span><span class="n">z</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Then, we wrangle our simulation results in the data frame <code class="docutils literal notranslate"><span class="pre">tracking_results</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tracking_results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span>
<span class="w">  </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">n_AB</span><span class="p">,</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_sim</span><span class="p">),</span>
<span class="w">  </span><span class="n">sim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">n_sim</span><span class="p">,</span>
<span class="w">    </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_AB</span>
<span class="w">  </span><span class="p">),</span>
<span class="w">  </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">z_sim</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The plot below illustrates the sequence of <span class="math notranslate nohighlight">\(z\)</span>-statistics we computed every time we peek at the A/B testing once we got a new visitor, randomized them, and recorded their response. The simulation sequences are coloured by each of the four replicates (<strong>a replicate is equivalent to one execution of <code class="docutils literal notranslate"><span class="pre">sim_monitor_track()</span></code></strong>).</p>
<p>Note there is a horizontal dashed line indicating the cutoff <span class="math notranslate nohighlight">\(z_{1 - \alpha} = 1.64\)</span> with <span class="math notranslate nohighlight">\(\alpha = 0.05\)</span>. Recall that we are continuously performing one-sided tests. Hence, when the computed test statistic <span class="math notranslate nohighlight">\(z_{\text{test}} &gt; z_{1 - \alpha}\)</span>, <strong>we have SUPPOSEDLY collected ENOUGH evidence to infer that <span class="math notranslate nohighlight">\(\text{CTR}_B &gt; \text{CTR}_A\)</span> with a significance level <span class="math notranslate nohighlight">\(\alpha\)</span></strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">warn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-1</span><span class="p">)</span>

<span class="n">tracking_plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tracking_results</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">sim</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">qnorm</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">alpha</span><span class="p">),</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;dashed&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme</span><span class="p">(</span>
<span class="w">    </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">),</span>
<span class="w">    </span><span class="n">strip.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">),</span>
<span class="w">    </span><span class="n">legend.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">margin</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cm&quot;</span><span class="p">)),</span><span class="w"> </span>
<span class="w">    </span><span class="n">legend.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">margin</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cm&quot;</span><span class="p">)),</span>
<span class="w">    </span><span class="n">legend.key.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">unit</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cm&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">xlab</span><span class="p">(</span><span class="s">&quot;Progressive Number of Vistors in A/B Testing&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">ylab</span><span class="p">(</span><span class="s">&quot;z-statistic&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Simulation Replicate&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">ggtitle</span><span class="p">(</span><span class="s">&quot;z-statistic Tracking by Simulation Replicate&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_color_brewer</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Dark2&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tracking_plot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/ebc6d5a237d01d0176bb862db73786bbba257b99a21ee64166e051f8bf5a84da.png"><img alt="../_images/ebc6d5a237d01d0176bb862db73786bbba257b99a21ee64166e051f8bf5a84da.png" src="../_images/ebc6d5a237d01d0176bb862db73786bbba257b99a21ee64166e051f8bf5a84da.png" style="width: 840px; height: 480px;" /></a>
</div>
</div>
<div class="hint admonition">
<p class="admonition-title">What is the main takeaway from this <span class="math notranslate nohighlight">\(z\)</span>-statistic tracking plot?</p>
<p><strong>Under this population scenario</strong>, the four simulation replicates lead us to gather evidence to conclude that</p>
<div class="math notranslate nohighlight">
\[\text{CTR}_B &gt; \text{CTR}_A,\]</div>
<p>given that eventually our computed <span class="math notranslate nohighlight">\(z_{\text{test}} &gt; z_{1 - \alpha}\)</span> (i.e., the <span class="math notranslate nohighlight">\(z\)</span>-statistic sequences cross the cutoff horizontal dashed line).</p>
<p>Note it <strong>MIGHT</strong> be beneficial to end the A/B testing before reaching the maximum planned overall sample size <span class="math notranslate nohighlight">\(n_{max}\)</span> <strong>WHILE PEEKING</strong>. However, let us dig more into this matter!</p>
</div>
</section>
<section id="three-simulation-studies-with-aggressive-peeking">
<h3>3.2. Three Simulation Studies with Aggressive Peeking<a class="headerlink" href="#three-simulation-studies-with-aggressive-peeking" title="Permalink to this heading">#</a></h3>
<p><strong>Before putting the previous appealing peeking idea into practice</strong>, we would need to run three simulation studies to check some key metrics (just as we did in <a class="reference internal" href="lecture3_randomization_and_blocking.html"><span class="doc">Lecture 3 - Randomization and Blocking</span></a> and <a class="reference internal" href="lecture4_more_blocking_and_power.html"><span class="doc">Lecture 4 - More Blocking and Power</span></a>). These studies involve what we call <strong>aggresive peeking</strong> (i.e., when we check our data and test statistic every time we have a new experimental unit).</p>
<p>Thus, let us run three whole simulation studies. The function <code class="docutils literal notranslate"><span class="pre">sim_monitor()</span></code> does the same job as <code class="docutils literal notranslate"><span class="pre">sim_monitor_track()</span></code>, both require the same arguments. However, <code class="docutils literal notranslate"><span class="pre">sim_monitor()</span></code> will only return the <strong>final <span class="math notranslate nohighlight">\(z_{\text{test}}\)</span></strong> for a given A/B testing simulation replicate and the number of visitors at which we reach <strong>significance</strong> that will be <strong>less or equal than <code class="docutils literal notranslate"><span class="pre">n_max</span></code></strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">sim_monitor</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">n_max</span><span class="p">,</span><span class="w"> </span><span class="n">CTR_A</span><span class="p">,</span><span class="w"> </span><span class="n">CTR_B</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1"># Significance level in A/B testing</span>
<span class="w">  </span><span class="n">alpha</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.05</span>

<span class="w">  </span><span class="c1"># Data to record in each iteration to compute the z-statistic</span>
<span class="w">  </span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
<span class="w">  </span><span class="n">z</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c1"># No test statistic at the beginning of the A/B testing</span>
<span class="w">  </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c1"># No visitors at the beginning of the A/B testing</span>

<span class="w">  </span><span class="c1"># We will recruit A/B testing visitors within the loop</span>
<span class="w">  </span><span class="c1"># The experiment will last while we do not have a significant result</span>
<span class="w">  </span><span class="c1"># AND we do not reach the maximum number of experimental units (n_max)</span>
<span class="w">  </span><span class="nf">while </span><span class="p">((</span><span class="n">z</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nf">qnorm</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">alpha</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_max</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c1"># Increasing the number of recruited visitors</span>

<span class="w">    </span><span class="c1"># Randomize the visitor to treatment A (0) or B (1)</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="m">0</span><span class="o">:</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
<span class="w">    </span><span class="c1"># See if they click on the link (1) or not (0)</span>
<span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rbinom</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">CTR_A</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">CTR_B</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># Update data table and recompute z-statistic</span>
<span class="w">    </span><span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span>

<span class="w">    </span><span class="c1"># Recomputing z-statistic</span>
<span class="w">    </span><span class="nf">if </span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">z</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">])</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">]))</span><span class="w"> </span><span class="o">/</span>
<span class="w">        </span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">data</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="nf">return</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<section id="what-happens-when-text-ctr-b-text-ctr-a-in-a-simulation-study-if-we-apply-aggressive-peeking-everytime-there-is-a-new-visitor">
<h4>3.2.1. What happens when <span class="math notranslate nohighlight">\(\text{CTR}_B &gt; \text{CTR}_A\)</span> in a simulation study if we apply aggressive peeking everytime there is a new visitor?<a class="headerlink" href="#what-happens-when-text-ctr-b-text-ctr-a-in-a-simulation-study-if-we-apply-aggressive-peeking-everytime-there-is-a-new-visitor" title="Permalink to this heading">#</a></h4>
<p>We will use the arguments <code class="docutils literal notranslate"><span class="pre">n_max</span> <span class="pre">=</span> <span class="pre">3930</span></code>, <code class="docutils literal notranslate"><span class="pre">CTR_A</span> <span class="pre">=</span> <span class="pre">0.03</span></code>, and <code class="docutils literal notranslate"><span class="pre">CTR_B</span> <span class="pre">=</span> <span class="pre">0.045</span></code> in <code class="docutils literal notranslate"><span class="pre">sim_monitor()</span></code> with <code class="docutils literal notranslate"><span class="pre">1000</span></code> replicates for our simulation study.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">set.seed</span><span class="p">(</span><span class="m">554</span><span class="p">)</span>

<span class="n">m_rep</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="c1"># Number of replicates</span>

<span class="n">results_1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">m_rep</span><span class="p">),</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">m_rep</span><span class="p">))</span><span class="w"> </span><span class="c1"># List of results</span>

<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">m_rep</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">sim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sim_monitor</span><span class="p">(</span><span class="n">n_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3930</span><span class="p">,</span><span class="w"> </span><span class="n">CTR_A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.03</span><span class="p">,</span><span class="w"> </span><span class="n">CTR_B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.045</span><span class="p">)</span>
<span class="w">  </span><span class="n">results_1</span><span class="o">$</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sim</span><span class="o">$</span><span class="n">z</span>
<span class="w">  </span><span class="n">results_1</span><span class="o">$</span><span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sim</span><span class="o">$</span><span class="n">n</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Under this scenario, we sort the <code class="docutils literal notranslate"><span class="pre">1000</span></code> values corresponding to those effective sample sizes at which the A/B testing was stopped <strong>from the smallest to the largest</strong>. Then, we make seven bins. In each bin, we obtain the proportion of <span class="math notranslate nohighlight">\(z\)</span>-statistics that were less or equal than the cutoff <span class="math notranslate nohighlight">\(z_{1 - \alpha} = 1.64\)</span> with <span class="math notranslate nohighlight">\(\alpha = 0.05\)</span> (column <code class="docutils literal notranslate"><span class="pre">(-Inf,1.64]</span></code>) and that proportion larger than <span class="math notranslate nohighlight">\(z_{1 - \alpha}\)</span> (column <code class="docutils literal notranslate"><span class="pre">(1.64,</span> <span class="pre">Inf]</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">sim_study_results_1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">table</span><span class="p">(</span>
<span class="w">  </span><span class="nf">cut</span><span class="p">(</span><span class="n">results_1</span><span class="o">$</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">500</span><span class="p">,</span><span class="w"> </span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="m">1500</span><span class="p">,</span><span class="w"> </span><span class="m">2000</span><span class="p">,</span><span class="w"> </span><span class="m">2500</span><span class="p">,</span><span class="w"> </span><span class="m">3000</span><span class="p">,</span><span class="w"> </span><span class="m">3930</span><span class="p">),</span><span class="w"> </span><span class="n">dig.lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">),</span>
<span class="w">  </span><span class="nf">cut</span><span class="p">(</span><span class="n">results_1</span><span class="o">$</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="o">-</span><span class="kc">Inf</span><span class="p">,</span><span class="w"> </span><span class="nf">qnorm</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">alpha</span><span class="p">),</span><span class="w"> </span><span class="kc">Inf</span><span class="p">))</span>
<span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">m_rep</span>

<span class="n">sim_study_results_1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">format</span><span class="p">(</span><span class="n">sim_study_results_1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">sim_study_results_1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A matrix: 7 × 2 of type chr</caption>
<thead>
	<tr><th></th><th scope=col>(-Inf,1.64]</th><th scope=col>(1.64, Inf]</th></tr>
</thead>
<tbody>
	<tr><th scope=row>(0,500]</th><td>0.000</td><td>0.338</td></tr>
	<tr><th scope=row>(500,1000]</th><td>0.000</td><td>0.207</td></tr>
	<tr><th scope=row>(1000,1500]</th><td>0.000</td><td>0.119</td></tr>
	<tr><th scope=row>(1500,2000]</th><td>0.000</td><td>0.091</td></tr>
	<tr><th scope=row>(2000,2500]</th><td>0.000</td><td>0.067</td></tr>
	<tr><th scope=row>(2500,3000]</th><td>0.000</td><td>0.038</td></tr>
	<tr><th scope=row>(3000,3930]</th><td>0.087</td><td>0.053</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="hint admonition">
<p class="admonition-title">What is the main takeaway from this simulation study in the context of this population?</p>
<p>The expression <span class="math notranslate nohighlight">\(\text{CTR}_B &gt; \text{CTR}_A\)</span> corresponds to our alternative hypothesis <span class="math notranslate nohighlight">\(H_a\)</span>. We know this hypothesis is in fact true since the population <span class="math notranslate nohighlight">\(\text{CTR}_A = 0.03\)</span> and <span class="math notranslate nohighlight">\(\text{CTR}_B = 0.045\)</span>. When <span class="math notranslate nohighlight">\(z_{\text{test}} \leq z_{1 - \alpha}\)</span>, we fail reject the null hypothesis <span class="math notranslate nohighlight">\(H_0\)</span> which is committing type II error! Hence this table is telling us that the <strong>observed power in this simulation study</strong> is <span class="math notranslate nohighlight">\(1 - \beta = 1 - 0.087 = 0.913\)</span>!</p>
<p>It seems that an <strong>aggresive peeking</strong> improves the power of the test when, in fact, <span class="math notranslate nohighlight">\(\text{CTR}_B &gt; \text{CTR}_A\)</span>. However, note that the increase from <span class="math notranslate nohighlight">\(\text{CTR}_A\)</span> to <span class="math notranslate nohighlight">\(\text{CTR}_B\)</span> is 50%.</p>
<p><strong>What would happen if the percentage CTR increase is smaller?</strong></p>
</div>
</section>
<section id="what-happens-when-text-ctr-b-text-ctr-a-under-a-smaller-percentage-increase-in-a-simulation-study-if-we-apply-aggresive-peeking-every-time-there-is-a-new-visitor">
<h4>3.2.2. What happens when <span class="math notranslate nohighlight">\(\text{CTR}_B &gt; \text{CTR}_A\)</span>  under a smaller percentage increase in a simulation study if we apply aggresive peeking every time there is a new visitor?<a class="headerlink" href="#what-happens-when-text-ctr-b-text-ctr-a-under-a-smaller-percentage-increase-in-a-simulation-study-if-we-apply-aggresive-peeking-every-time-there-is-a-new-visitor" title="Permalink to this heading">#</a></h4>
<p>We will use the arguments <code class="docutils literal notranslate"><span class="pre">n_max</span> <span class="pre">=</span> <span class="pre">3930</span></code>, <code class="docutils literal notranslate"><span class="pre">CTR_A</span> <span class="pre">=</span> <span class="pre">0.03</span></code>, and <code class="docutils literal notranslate"><span class="pre">CTR_B</span> <span class="pre">=</span> <span class="pre">0.036</span></code> in <code class="docutils literal notranslate"><span class="pre">sim_monitor()</span></code> with <code class="docutils literal notranslate"><span class="pre">1000</span></code> replicates for our simulation study. <strong>This is a CTR percentage increase of 20%.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">set.seed</span><span class="p">(</span><span class="m">554</span><span class="p">)</span>

<span class="n">m_rep</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="c1"># Number of replicates</span>

<span class="n">results_2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">m_rep</span><span class="p">),</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">m_rep</span><span class="p">))</span><span class="w"> </span><span class="c1"># List of results</span>

<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">m_rep</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">sim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sim_monitor</span><span class="p">(</span><span class="n">n_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3930</span><span class="p">,</span><span class="w"> </span><span class="n">CTR_A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.03</span><span class="p">,</span><span class="w"> </span><span class="n">CTR_B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.036</span><span class="p">)</span>
<span class="w">  </span><span class="n">results_2</span><span class="o">$</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sim</span><span class="o">$</span><span class="n">z</span>
<span class="w">  </span><span class="n">results_2</span><span class="o">$</span><span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sim</span><span class="o">$</span><span class="n">n</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Then, we obtain the seven-bin table as in the previous simulation study.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">sim_study_results_2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">table</span><span class="p">(</span>
<span class="w">  </span><span class="nf">cut</span><span class="p">(</span><span class="n">results_2</span><span class="o">$</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">500</span><span class="p">,</span><span class="w"> </span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="m">1500</span><span class="p">,</span><span class="w"> </span><span class="m">2000</span><span class="p">,</span><span class="w"> </span><span class="m">2500</span><span class="p">,</span><span class="w"> </span><span class="m">3000</span><span class="p">,</span><span class="w"> </span><span class="m">3930</span><span class="p">),</span><span class="w"> </span><span class="n">dig.lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">),</span>
<span class="w">  </span><span class="nf">cut</span><span class="p">(</span><span class="n">results_2</span><span class="o">$</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="o">-</span><span class="kc">Inf</span><span class="p">,</span><span class="w"> </span><span class="nf">qnorm</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">alpha</span><span class="p">),</span><span class="w"> </span><span class="kc">Inf</span><span class="p">))</span>
<span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">m_rep</span>

<span class="n">sim_study_results_2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">format</span><span class="p">(</span><span class="n">sim_study_results_2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">sim_study_results_2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A matrix: 7 × 2 of type chr</caption>
<thead>
	<tr><th></th><th scope=col>(-Inf,1.64]</th><th scope=col>(1.64, Inf]</th></tr>
</thead>
<tbody>
	<tr><th scope=row>(0,500]</th><td>0.000</td><td>0.182</td></tr>
	<tr><th scope=row>(500,1000]</th><td>0.000</td><td>0.100</td></tr>
	<tr><th scope=row>(1000,1500]</th><td>0.000</td><td>0.078</td></tr>
	<tr><th scope=row>(1500,2000]</th><td>0.000</td><td>0.050</td></tr>
	<tr><th scope=row>(2000,2500]</th><td>0.000</td><td>0.040</td></tr>
	<tr><th scope=row>(2500,3000]</th><td>0.000</td><td>0.045</td></tr>
	<tr><th scope=row>(3000,3930]</th><td>0.454</td><td>0.051</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="hint admonition">
<p class="admonition-title">What is the main takeaway from this simulation study in the context of this population?</p>
<p>When there is an <strong>aggresive peeking</strong> in a population scenario under a small percentage CTR increase, then we see a <strong>concerning power decrease</strong>. The power is <span class="math notranslate nohighlight">\(1 - \beta = 1 - 0.454 = 0.546\)</span>.</p>
</div>
</section>
<section id="what-happens-when-text-ctr-b-text-ctr-a-in-a-simulation-study-if-we-apply-aggresive-peeking-everytime-there-is-a-new-visitor">
<h4>3.2.3. What happens when <span class="math notranslate nohighlight">\(\text{CTR}_B = \text{CTR}_A\)</span> in a simulation study if we apply aggresive peeking everytime there is a new visitor?<a class="headerlink" href="#what-happens-when-text-ctr-b-text-ctr-a-in-a-simulation-study-if-we-apply-aggresive-peeking-everytime-there-is-a-new-visitor" title="Permalink to this heading">#</a></h4>
<p>We will use the arguments <code class="docutils literal notranslate"><span class="pre">n_max</span> <span class="pre">=</span> <span class="pre">3930</span></code>, <code class="docutils literal notranslate"><span class="pre">CTR_A</span> <span class="pre">=</span> <span class="pre">0.03</span></code>, and <code class="docutils literal notranslate"><span class="pre">CTR_B</span> <span class="pre">=</span> <span class="pre">0.03</span></code> in <code class="docutils literal notranslate"><span class="pre">sim_monitor()</span></code> with <code class="docutils literal notranslate"><span class="pre">1000</span></code> replicates for our simulation study.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">set.seed</span><span class="p">(</span><span class="m">554</span><span class="p">)</span>

<span class="n">m_rep</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="c1"># Number of replicates</span>

<span class="n">results_3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">m_rep</span><span class="p">),</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">m_rep</span><span class="p">))</span><span class="w"> </span><span class="c1"># List of results</span>

<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">m_rep</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">sim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sim_monitor</span><span class="p">(</span><span class="n">n_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3930</span><span class="p">,</span><span class="w"> </span><span class="n">CTR_A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.03</span><span class="p">,</span><span class="w"> </span><span class="n">CTR_B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.03</span><span class="p">)</span>
<span class="w">  </span><span class="n">results_3</span><span class="o">$</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sim</span><span class="o">$</span><span class="n">z</span>
<span class="w">  </span><span class="n">results_3</span><span class="o">$</span><span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sim</span><span class="o">$</span><span class="n">n</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Then, we obtain the seven-bin table as in the previous simulation study.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">sim_study_results_3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">table</span><span class="p">(</span>
<span class="w">  </span><span class="nf">cut</span><span class="p">(</span><span class="n">results_3</span><span class="o">$</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">500</span><span class="p">,</span><span class="w"> </span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="m">1500</span><span class="p">,</span><span class="w"> </span><span class="m">2000</span><span class="p">,</span><span class="w"> </span><span class="m">2500</span><span class="p">,</span><span class="w"> </span><span class="m">3000</span><span class="p">,</span><span class="w"> </span><span class="m">3930</span><span class="p">),</span><span class="w"> </span><span class="n">dig.lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">),</span>
<span class="w">  </span><span class="nf">cut</span><span class="p">(</span><span class="n">results_3</span><span class="o">$</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="o">-</span><span class="kc">Inf</span><span class="p">,</span><span class="w"> </span><span class="nf">qnorm</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">alpha</span><span class="p">),</span><span class="w"> </span><span class="kc">Inf</span><span class="p">))</span>
<span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">m_rep</span>

<span class="n">sim_study_results_3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">format</span><span class="p">(</span><span class="n">sim_study_results_3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">sim_study_results_3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A matrix: 7 × 2 of type chr</caption>
<thead>
	<tr><th></th><th scope=col>(-Inf,1.64]</th><th scope=col>(1.64, Inf]</th></tr>
</thead>
<tbody>
	<tr><th scope=row>(0,500]</th><td>0.000</td><td>0.103</td></tr>
	<tr><th scope=row>(500,1000]</th><td>0.000</td><td>0.051</td></tr>
	<tr><th scope=row>(1000,1500]</th><td>0.000</td><td>0.029</td></tr>
	<tr><th scope=row>(1500,2000]</th><td>0.000</td><td>0.019</td></tr>
	<tr><th scope=row>(2000,2500]</th><td>0.000</td><td>0.013</td></tr>
	<tr><th scope=row>(2500,3000]</th><td>0.000</td><td>0.015</td></tr>
	<tr><th scope=row>(3000,3930]</th><td>0.751</td><td>0.019</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="hint admonition">
<p class="admonition-title">What is the main takeaway from this simulation study in the context of this population?</p>
<p>In this context, the null hypothesis <span class="math notranslate nohighlight">\(H_0\)</span> is true! Hence the proportion of replicates where <span class="math notranslate nohighlight">\(z_{\text{test}} &gt; z_{1 - \alpha}\)</span> correspond to the type I error. In this case, an <strong>aggresive peeking</strong> severely inflates the type I error <span class="math notranslate nohighlight">\(\alpha = 1 - 0.751 = 0.249\)</span>.</p>
</div>
</section>
</section>
<section id="final-simulation-studies-with-principled-peeking">
<h3>3.3. Final Simulation Studies with Principled Peeking<a class="headerlink" href="#final-simulation-studies-with-principled-peeking" title="Permalink to this heading">#</a></h3>
<p>Recall that <strong>non-peeking</strong> and <strong>aggresive peeking</strong> are the following extremes in A/B testing:</p>
<ul class="simple">
<li><p>Accruing all <span class="math notranslate nohighlight">\(n_{\text{max}}\)</span> experimental units and not computing/looking at the test statistic until then (<strong>non-peeking</strong>).</p></li>
<li><p><strong>Real-time</strong> monitoring of the test statistic and stopping early (<strong>aggresive peeking</strong>).</p></li>
</ul>
<p>Both extremes might not be good ideas! Hence, is there something in between these two extremes?</p>
<div class="important admonition">
<p class="admonition-title">Basics of Principled Peeking</p>
<p>A common A/B testing practice is <strong>principled peeking</strong>. This practice involves defining a fixed number of peeks <strong>before starting the experiment</strong>. It has the following characteristics:</p>
<ul class="simple">
<li><p>Define an <span class="math notranslate nohighlight">\(m\)</span> number of <strong>principled peeks</strong> <strong>before starting the experiment</strong>.</p></li>
<li><p><strong>Principled peeks</strong> will begin at a certain collected number of recruited experimental units <span class="math notranslate nohighlight">\(n_{\text{min}} &gt; 0\)</span>.</p></li>
<li><p><strong>Principled peeks</strong> will be evenly spaced between experimental units <span class="math notranslate nohighlight">\(n_{\text{min}}\)</span> and <span class="math notranslate nohighlight">\(n_{\text{max}}\)</span>.</p></li>
<li><p>Use the Bonferroni correction to adjust <span class="math notranslate nohighlight">\(\alpha\)</span> in our hypothesis testings such that <span class="math notranslate nohighlight">\(\alpha / m\)</span>.</p></li>
<li><p>If at a certain <strong>principled peek</strong> we reach significance before <span class="math notranslate nohighlight">\(n_{\text{max}}\)</span>, then the A/B testing stops.</p></li>
<li><p>If we never reach significance before <span class="math notranslate nohighlight">\(n_{\text{max}}\)</span>, then the last <strong>principled peek</strong> will correspond to <span class="math notranslate nohighlight">\(n_{\text{max}}\)</span>.</p></li>
</ul>
</div>
<p>Function <code class="docutils literal notranslate"><span class="pre">sim_rej()</span></code> executes a set of simulation CTR studies under a defined number of principled peeks (one study with <code class="docutils literal notranslate"><span class="pre">m_rep</span></code> replicates per principled peek). These peeks begin at the experimental unit <code class="docutils literal notranslate"><span class="pre">n_min</span></code>. The rest of the arguments are the same ones from our previous functions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">sim_rej</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">n_min</span><span class="p">,</span><span class="w"> </span><span class="n">n_max</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="n">CTR_A</span><span class="p">,</span><span class="w"> </span><span class="n">CTR_B</span><span class="p">,</span><span class="w"> </span><span class="n">n_peeks</span><span class="p">,</span><span class="w"> </span><span class="n">m_rep</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="c1"># Setting up overall study metrics by number of peek setting</span>
<span class="w">  </span><span class="n">rej_mean</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">n_peeks</span><span class="p">))</span>
<span class="w">  </span><span class="n">rej_sd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">n_peeks</span><span class="p">))</span>
<span class="w">  </span><span class="n">n_mean</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">n_peeks</span><span class="p">))</span>
<span class="w">  </span><span class="n">n_sd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">n_peeks</span><span class="p">))</span>

<span class="w">  </span><span class="c1"># Beginning studies</span>
<span class="w">  </span><span class="c1"># By number of principled peekings</span>
<span class="w">  </span><span class="nf">for </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">n_peeks</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">z_cutoff</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">qnorm</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">n_peeks</span><span class="p">[</span><span class="n">n</span><span class="p">])</span><span class="w"> </span><span class="c1"># Note the Bonferroni correction for z cutoff value!</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1"># Visitor numbers at which peek happens</span>
<span class="w">    </span><span class="n">n_inspect</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">n_min</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">n_max</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">n_min</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">n_peeks</span><span class="p">[</span><span class="n">n</span><span class="p">])</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">n_peeks</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>

<span class="w">    </span><span class="c1"># Individual simulation study metrics</span>
<span class="w">    </span><span class="n">rej</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">m_rep</span><span class="p">)</span>
<span class="w">    </span><span class="n">n_stop</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">m_rep</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># Beginning individual simulation</span>
<span class="w">    </span><span class="nf">for </span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">m_rep</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">      </span><span class="c1"># Test statistics to record</span>
<span class="w">      </span><span class="n">zz</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">n_inspect</span><span class="p">))</span>

<span class="w">      </span><span class="c1"># Simulating the sequence of all visitors</span>
<span class="w">      </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="m">0</span><span class="o">:</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_max</span><span class="p">,</span><span class="w"> </span><span class="n">replace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>
<span class="w">      </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rbinom</span><span class="p">(</span><span class="n">n_max</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">CTR_A</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">CTR_B</span><span class="p">)</span>

<span class="w">      </span><span class="c1"># Executing planned hypothesis testings (by number of peeks)</span>
<span class="w">      </span><span class="nf">for </span><span class="p">(</span><span class="n">ni</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">n_inspect</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="c1"># Updating terms to compute test statistic</span>
<span class="w">        </span><span class="n">np</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">n_inspect</span><span class="p">[</span><span class="n">ni</span><span class="p">]</span>
<span class="w">        </span><span class="n">x_new</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="n">np</span><span class="p">])</span>
<span class="w">        </span><span class="n">x_old</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">np</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x_new</span>
<span class="w">        </span><span class="n">y_1_new</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="n">np</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="n">np</span><span class="p">])</span>
<span class="w">        </span><span class="n">y_1_old</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">((</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="n">np</span><span class="p">])</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="n">np</span><span class="p">])</span>

<span class="w">        </span><span class="n">p_star</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">y_1_new</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y_1_old</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">np</span>
<span class="w">        </span><span class="n">z</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">y_1_new</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">x_new</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y_1_old</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">x_old</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">p_star</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p_star</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">x_new</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">x_old</span><span class="p">)))</span>
<span class="w">        </span><span class="nf">if </span><span class="p">(</span><span class="nf">is.nan</span><span class="p">(</span><span class="n">z</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">z</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">zz</span><span class="p">[</span><span class="n">ni</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">z</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="c1"># Shall we stop the study at a given peek?</span>
<span class="w">      </span><span class="n">rej</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">any</span><span class="p">(</span><span class="n">zz</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">z_cutoff</span><span class="p">)</span><span class="w"> </span><span class="c1"># +1 in metric if we reject the null hypothesis</span>
<span class="w">      </span><span class="nf">if </span><span class="p">(</span><span class="n">rej</span><span class="p">[</span><span class="n">m</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">n_stop</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">n_inspect</span><span class="p">[</span><span class="nf">which</span><span class="p">(</span><span class="n">zz</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">z_cutoff</span><span class="p">)[</span><span class="m">1</span><span class="p">]]</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">n_stop</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">n_max</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1"># Computing overall study metrics by number of peeks settings</span>
<span class="w">    </span><span class="n">rej_mean</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">rej</span><span class="p">)</span><span class="w"> </span><span class="c1"># Proportion of times we rejected the null hypothesis</span>
<span class="w">    </span><span class="n">rej_sd</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sd</span><span class="p">(</span><span class="n">rej</span><span class="p">)</span>
<span class="w">    </span><span class="n">n_mean</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">n_stop</span><span class="p">)</span><span class="w"> </span><span class="c1"># Average number of visitors required for early stopping</span>
<span class="w">    </span><span class="n">n_sd</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sd</span><span class="p">(</span><span class="n">n_stop</span><span class="p">)</span>
<span class="w">    </span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="nf">return</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">rej_mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rej_mean</span><span class="p">,</span><span class="w"> </span><span class="n">rej_sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rej_sd</span><span class="p">,</span><span class="w"> </span><span class="n">n_mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_mean</span><span class="p">,</span><span class="w"> </span><span class="n">n_sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_sd</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>We execute <code class="docutils literal notranslate"><span class="pre">sim_rej()</span></code> with the arguments below. Note we set up the following principled peeks: <code class="docutils literal notranslate"><span class="pre">1,</span> <span class="pre">2,</span> <span class="pre">5,</span> <span class="pre">10,</span> <span class="pre">15,</span> <span class="pre">20,</span> <span class="pre">25</span></code>. Our <code class="docutils literal notranslate"><span class="pre">n_min</span></code> parameter is <code class="docutils literal notranslate"><span class="pre">1000</span></code>. Moreover, we run these studies under two realities:</p>
<ul class="simple">
<li><p><strong>Reality 1:</strong> No change in CTRs between both treatments.</p></li>
<li><p><strong>Reality 2:</strong> Increase from <span class="math notranslate nohighlight">\(\text{CTR}_A = 0.03\)</span> to <span class="math notranslate nohighlight">\(\text{CTR}_B = 0.045\)</span>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">set.seed</span><span class="p">(</span><span class="m">321</span><span class="p">)</span>

<span class="c1"># Running reality 1</span>
<span class="n">reality_1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sim_rej</span><span class="p">(</span>
<span class="w">  </span><span class="n">n_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="n">n_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3930</span><span class="p">,</span><span class="w"> </span><span class="n">CTR_A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.03</span><span class="p">,</span><span class="w"> </span><span class="n">CTR_B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.03</span><span class="p">,</span>
<span class="w">  </span><span class="n">n_peeks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">25</span><span class="p">),</span><span class="w"> </span><span class="n">m_rep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span>
<span class="p">)</span>

<span class="c1"># Collecting type I error for Reality 1</span>
<span class="n">reality_1_type_1_error</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">tibble</span><span class="p">(</span><span class="n">n_peeks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">25</span><span class="p">),</span><span class="w"> </span><span class="n">type_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reality_1</span><span class="o">$</span><span class="n">rej_mean</span><span class="p">)</span>

<span class="c1"># Running reality 2</span>
<span class="n">reality_2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sim_rej</span><span class="p">(</span>
<span class="w">  </span><span class="n">n_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="n">n_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3930</span><span class="p">,</span><span class="w"> </span><span class="n">CTR_A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.03</span><span class="p">,</span><span class="w"> </span><span class="n">CTR_B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.045</span><span class="p">,</span>
<span class="w">  </span><span class="n">n_peeks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">25</span><span class="p">),</span><span class="w"> </span><span class="n">m_rep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span>
<span class="p">)</span>

<span class="c1"># Collecting power for Reality 2</span>
<span class="n">reality_2_power</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">tibble</span><span class="p">(</span><span class="n">n_peeks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">25</span><span class="p">),</span><span class="w"> </span><span class="n">power</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reality_2</span><span class="o">$</span><span class="n">rej_mean</span><span class="p">)</span>

<span class="c1"># Collecting average recruited visitors by reality and number of peeks</span>
<span class="n">avg_recruited</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">tibble</span><span class="p">(</span>
<span class="w">  </span><span class="n">Reality</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="s">&quot;Reality 1&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">),</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="s">&quot;Reality 2&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">))),</span>
<span class="w">  </span><span class="n">n_peeks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">25</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">),</span>
<span class="w">  </span><span class="n">avg_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">reality_1</span><span class="o">$</span><span class="n">n_mean</span><span class="p">,</span><span class="w"> </span><span class="n">reality_2</span><span class="o">$</span><span class="n">n_mean</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, let us check the below plotting arrangement. The plot on top illustrates the average sampled experimental units by principled peeking strategy on the <span class="math notranslate nohighlight">\(x\)</span>-axis by reality. The other two plots at the bottom show the type I error rate in <strong>Reality 1</strong> and the power in <strong>Reality 2</strong> by principled peeking strategy on the <span class="math notranslate nohighlight">\(x\)</span>-axis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">repr.plot.width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">14</span><span class="p">)</span>

<span class="n">avg_vistors_reality</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">avg_recruited</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_peeks</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">avg_number</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Reality</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_line</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme</span><span class="p">(</span>
<span class="w">    </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">),</span>
<span class="w">    </span><span class="n">strip.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">),</span>
<span class="w">    </span><span class="n">legend.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">margin</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cm&quot;</span><span class="p">)),</span><span class="w"> </span>
<span class="w">    </span><span class="n">legend.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">margin</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cm&quot;</span><span class="p">)),</span>
<span class="w">    </span><span class="n">legend.key.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">unit</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cm&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Number of Peeks in A/B Testing&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Average Recruited Visitors&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">25</span><span class="p">),</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">25</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">ggtitle</span><span class="p">(</span><span class="s">&quot;Average Recruited Visitors by Reality&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_color_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;blue&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">coord_cartesian</span><span class="p">(</span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2900</span><span class="p">,</span><span class="w"> </span><span class="m">4000</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">3000</span><span class="p">,</span><span class="w"> </span><span class="m">4000</span><span class="p">,</span><span class="w"> </span><span class="m">200</span><span class="p">))</span>

<span class="n">type_1_error_reality_1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">reality_1_type_1_error</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_peeks</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type_1</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;red&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_line</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;red&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme</span><span class="p">(</span>
<span class="w">    </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">18</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">),</span>
<span class="w">    </span><span class="n">strip.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">),</span>
<span class="w">    </span><span class="n">legend.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">margin</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cm&quot;</span><span class="p">)),</span><span class="w"> </span>
<span class="w">    </span><span class="n">legend.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">margin</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cm&quot;</span><span class="p">)),</span>
<span class="w">    </span><span class="n">legend.key.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">unit</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cm&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Number of Peeks in A/B Testing&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Type I Error Rate&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">coord_cartesian</span><span class="p">(</span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0.06</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0.06</span><span class="p">,</span><span class="w"> </span><span class="m">0.01</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">25</span><span class="p">),</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">25</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">ggtitle</span><span class="p">(</span><span class="s">&quot;Reality 1: Type I Error Rate by Number of Peeks&quot;</span><span class="p">)</span>

<span class="n">power_reality_2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">reality_2_power</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_peeks</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">power</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;blue&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_line</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;blue&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme</span><span class="p">(</span>
<span class="w">    </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">18</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">),</span>
<span class="w">    </span><span class="n">strip.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">),</span>
<span class="w">    </span><span class="n">legend.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">margin</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cm&quot;</span><span class="p">)),</span><span class="w"> </span>
<span class="w">    </span><span class="n">legend.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">margin</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cm&quot;</span><span class="p">)),</span>
<span class="w">    </span><span class="n">legend.key.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">unit</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cm&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Number of Peeks in A/B Testing&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Power&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">coord_cartesian</span><span class="p">(</span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.4</span><span class="p">,</span><span class="w"> </span><span class="m">0.9</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">0.4</span><span class="p">,</span><span class="w"> </span><span class="m">0.9</span><span class="p">,</span><span class="w"> </span><span class="m">0.05</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">25</span><span class="p">),</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">25</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">ggtitle</span><span class="p">(</span><span class="s">&quot;Reality 2: Power by Number of Peeks&quot;</span><span class="p">)</span>

<span class="n">bottom_row</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">plot_grid</span><span class="p">(</span><span class="n">type_1_error_reality_1</span><span class="p">,</span><span class="w"> </span><span class="n">power_reality_2</span><span class="p">,</span><span class="w"> </span><span class="n">align</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;h&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">plot_grid</span><span class="p">(</span><span class="n">avg_vistors_reality</span><span class="p">,</span><span class="w"> </span><span class="n">bottom_row</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/fe92b236a7519863a69790809e0a48d7261e26e489a0b4203a61b01c07f5567e.png"><img alt="../_images/fe92b236a7519863a69790809e0a48d7261e26e489a0b4203a61b01c07f5567e.png" src="../_images/fe92b236a7519863a69790809e0a48d7261e26e489a0b4203a61b01c07f5567e.png" style="width: 840px; height: 720px;" /></a>
</div>
</div>
<div class="hint admonition">
<p class="admonition-title">What are the main takeaways from these plots?</p>
<ul class="simple">
<li><p>There is a decrease in recruited visitors when we have 5 principled peeks in <strong>Reality 2</strong> (<span class="math notranslate nohighlight">\(\text{CTR}_B &gt; \text{CTR}_A \)</span>). This does not happen in <strong>Reality 1</strong> (<span class="math notranslate nohighlight">\(\text{CTR}_B = \text{CTR}_A \)</span>) at any number of principled peeks.</p></li>
<li><p>The Bonferroni correction greatly prevents false positives as we increase the number of principled peeks in <strong>Reality 1</strong>.</p></li>
<li><p>We need to be cautious when increasing the number of principled peeks in <strong>Reality 2</strong> since this might impact the power. From these plots, <strong>2 principled peeks are ideal</strong>!</p></li>
</ul>
</div>
</section>
</section>
<section id="wrapping-up">
<h2>4. Wrapping Up<a class="headerlink" href="#wrapping-up" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>A clever plotting in Power Analysis is mandatory in A/B testing practice.</p></li>
<li><p>Early stopping in A/B testing is an appealing idea, but we have to be statistically cautious.</p></li>
<li><p>In <strong>aggressive peeking</strong>, we see “decent” power if indeed the experimental treatment B beats the control treatment A <strong>by a large amount</strong>. However, if both CTRs are close, then <strong>aggressive peeking</strong> plays against our power.</p></li>
<li><p>In <strong>aggressive peeking</strong>, we will have type I error rate inflation if experimental treatment B is actually no better than control treatment A.</p></li>
<li><p><strong>Principled peeking</strong> involves planning our test checking and relies on the Bonferroni correction. It prevents type I error rate inflation if experimental treatment B is actually no better than control treatment A.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            name: "ir",
            path: "./notes"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="lecture4_more_blocking_and_power.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lecture 4 - More Blocking and Power</p>
      </div>
    </a>
    <a class="right-next"
       href="lecture6_obs_stratifying_modelling.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lecture 6 - Observational Data: Stratifying and Modelling</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#today-s-learning-objectives">Today’s Learning Objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-r-packages">Loading <code class="docutils literal notranslate"><span class="pre">R</span></code> Packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sample-size-computations-in-plots">1. Sample Size Computations in Plots</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#revisiting-the-example">1.1. Revisiting the Example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-function-pwr-t-test">1.2. Using Function <code class="docutils literal notranslate"><span class="pre">pwr.t.test()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-results">1.3. Plotting Results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#alternative-plotting">1.4. Alternative Plotting</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sample-size-computations-with-click-through-rates">2. Sample Size Computations with Click-through Rates</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-interlude-on-the-arcsine-transformation-for-the-effect-size">2.1. An Interlude on the Arcsine Transformation for the Effect Size</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-function-pwr-2p-test">2.2. Using Function <code class="docutils literal notranslate"><span class="pre">pwr.2p.test()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#early-stopping-in-a-b-testing">3. Early Stopping in A/B Testing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-to-peeking">3.1. Introduction to Peeking</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#three-simulation-studies-with-aggressive-peeking">3.2. Three Simulation Studies with Aggressive Peeking</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#what-happens-when-text-ctr-b-text-ctr-a-in-a-simulation-study-if-we-apply-aggressive-peeking-everytime-there-is-a-new-visitor">3.2.1. What happens when <span class="math notranslate nohighlight">\(\text{CTR}_B &gt; \text{CTR}_A\)</span> in a simulation study if we apply aggressive peeking everytime there is a new visitor?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#what-happens-when-text-ctr-b-text-ctr-a-under-a-smaller-percentage-increase-in-a-simulation-study-if-we-apply-aggresive-peeking-every-time-there-is-a-new-visitor">3.2.2. What happens when <span class="math notranslate nohighlight">\(\text{CTR}_B &gt; \text{CTR}_A\)</span>  under a smaller percentage increase in a simulation study if we apply aggresive peeking every time there is a new visitor?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#what-happens-when-text-ctr-b-text-ctr-a-in-a-simulation-study-if-we-apply-aggresive-peeking-everytime-there-is-a-new-visitor">3.2.3. What happens when <span class="math notranslate nohighlight">\(\text{CTR}_B = \text{CTR}_A\)</span> in a simulation study if we apply aggresive peeking everytime there is a new visitor?</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#final-simulation-studies-with-principled-peeking">3.3. Final Simulation Studies with Principled Peeking</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#wrapping-up">4. Wrapping Up</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By G. Alexi Rodríguez-Arelis
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>